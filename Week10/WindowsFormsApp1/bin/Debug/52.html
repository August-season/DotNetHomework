<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="referrer" content="origin-when-crossorigin" />
    <meta name="description" content="话不多说，入正题。一个简单的权限控制系统需要考虑的问题如下： 权限如何加载 权限匹配规则 登录 1. 引入maven依赖 1 &amp;lt;?xml version=&amp;quot;1.0&amp;quot; enco" />
    <meta property="og:description" content="话不多说，入正题。一个简单的权限控制系统需要考虑的问题如下： 权限如何加载 权限匹配规则 登录 1. 引入maven依赖 1 &amp;lt;?xml version=&amp;quot;1.0&amp;quot; enco" />
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>基于 Spring Security 的前后端分离的权限控制系统 - 废物大师兄 - 博客园</title>
    <link id="favicon" rel="shortcut icon" href="//common.cnblogs.com/favicon.svg" type="image/svg+xml" />
    
    <link rel="stylesheet" href="/css/blog-common.min.css?v=6tvK5XC6GPbg3p_sy7wzz_2291HoYACr4440iKBzQIw" />
    <link id="MainCss" rel="stylesheet" href="/skins/darkgreentrip/bundle-darkgreentrip.min.css?v=eoZATbPKwJCL5eWVDTQIYC6CIxJPcFz191dkzN2tSyQ" />
    <link type="text/css" rel="stylesheet" href="https://www.cnblogs.com/cjsblog/custom.css?v=UFbU/dh4&#x2B;y0zN9F/qbUQblZzPNs=" />
    <link id="mobile-style" media="only screen and (max-width: 767px)" type="text/css" rel="stylesheet" href="/skins/darkgreentrip/bundle-darkgreentrip-mobile.min.css?v=lU86o8mZVn3FOSdFt7nHKYTD8gzeKaiQIIZ6lSjEFyo" />
    
    <link type="application/rss+xml" rel="alternate" href="https://www.cnblogs.com/cjsblog/rss" />
    <link type="application/rsd+xml" rel="EditURI" href="https://www.cnblogs.com/cjsblog/rsd.xml" />
    <link type="application/wlwmanifest+xml" rel="wlwmanifest" href="https://www.cnblogs.com/cjsblog/wlwmanifest.xml" />
    <script>
        var currentBlogId = 303122;
        var currentBlogApp = 'cjsblog';
        var cb_enable_mathjax = false;
        var isLogined = false;
        var isBlogOwner = false;
        var skinName = 'darkgreentrip';
        var visitorUserId = '';
    </script>
        <script>
            var currentPostDateAdded = '2021-06-19 08:29';
        </script>
    <script src="https://common.cnblogs.com/scripts/jquery-2.2.0.min.js"></script>
    <script src="/js/blog-common.min.js?v=ZUvfwhWs5fv-s8Nv7WofCOhwKAxiDO928zdWFzhnOPk"></script>
    
    
    
</head>
<body class="no-navbar">
    <a name="top"></a>
            <div id="bannerbar" class="bannerbar-mobile formobile">
            <a href="https://cloud.baidu.com/campaign/2021mid/index.html?track=cp:bokeyuan|pf:mb|pp:bokeyuan-huodong-21nianzhongdacu-neiyeyidongduantonglanbanner|pu:21nianzhongdacu-neiyeyidongduantonglanbanner|ci:21nzdc|kw:10224547" onclick="ga('send', 'event', 'Link', 'click', 'baidu-cpa-blog-bannerbar-mobile')">
                <img src="https://img2020.cnblogs.com/blog/35695/202106/35695-20210610184806729-1738888164.jpg" alt="" />
            </a>
            </div>
    <div id="top_nav" class="navbar forpc navbar-custom">
        <nav id="nav_main" class="navbar-main">
            <ul id="nav_left" class="navbar-list navbar-left">
                <li class="navbar-branding"><a href="https://www.cnblogs.com/" title="开发者的网上家园"><img src="/images/logo.svg?v=R9M0WmLAIPVydmdzE2keuvnjl-bPR7_35oHqtiBzGsM" alt="博客园Logo" /></a></li>
                <li><a href="/" onclick="ga('send', 'event', 'Link', 'click', 'skin-navbar-sitehome')">首页</a></li>
                <li><a href="https://news.cnblogs.com/" onclick="ga('send', 'event', 'Link', 'click', 'skin-navbar-news')">新闻</a></li>
                <li><a href="https://q.cnblogs.com/" onclick="ga('send', 'event', 'Link', 'click', 'skin-navbar-q')">博问</a></li>
                <li><a id="nav_brandzone" href="https://brands.cnblogs.com/" onclick="ga('send', 'event', 'Link', 'click', 'skin-navbar-brands')">专区</a></li>
                <li><a href="https://ing.cnblogs.com/" onclick="ga('send', 'event', 'Link', 'click', 'skin-navbar-ing')">闪存</a></li>
                <li><a href="https://edu.cnblogs.com/" onclick="ga('send', 'event', 'Link', 'click', 'skin-navbar-edu')">班级</a></li>
            </ul>
            <ul id="nav_right" class="navbar-list navbar-right">
                <li>
                    <form id="zzk_search" class="navbar-search" action="https://zzk.cnblogs.com/s" method="get">
                        <input name="w" id="zzk_search_input" placeholder="代码改变世界" type="text" tabindex="3" />
                        <button type="submit" id="zzk_search_button">
                            <img src="/images/aggsite/search.svg" alt="搜索" />
                        </button>
                    </form>
                </li>
                <li id="navbar_login_status" class="navbar-list">
                    <a class="navbar-user-info navbar-blog" href="https://i.cnblogs.com/EditPosts.aspx?opt=1" alt="写随笔" title="写随笔">
                        <img id="new_post_icon" class="navbar-icon" src="/images/aggsite/newpost.svg" alt="写随笔" />
                    </a>
                    <a id="navblog-myblog-icon" class="navbar-user-info navbar-blog" href="https://passport.cnblogs.com/GetBlogApplyStatus.aspx" alt="我的博客" title="我的博客">
                        <img id="myblog_icon" class="navbar-icon" src="/images/aggsite/myblog.svg" alt="我的博客" />
                    </a>
                    <a class="navbar-user-info navbar-message navbar-icon-wrapper" href="https://msg.cnblogs.com/" alt="短消息" title="短消息">
                        <img id="msg_icon" class="navbar-icon" src="/images/aggsite/message.svg?v=J0WS2P2iPgaIVgXxcAhliw4AFZIpaTWxtdoNAv9eiCA" alt="短消息" />
                        <span id="msg_count" style="display: none"></span>
                    </a>
                    <div id="user_info" class="navbar-user-info dropdown">
                        <a class="dropdown-button" href="https://home.cnblogs.com/">
                            <img id="user_icon" class="navbar-avatar" src="/images/aggsite/avatar-default.svg" alt="用户头像" />
                        </a>
                        <div class="dropdown-menu">
                            <a id="navblog-myblog-text" href="https://passport.cnblogs.com/GetBlogApplyStatus.aspx">我的博客</a>
                            <a href="https://home.cnblogs.com/">我的园子</a>
                            <a href="https://account.cnblogs.com/settings/account">账号设置</a>
                            <a href="javascript:void(0)" id="navbar_lite_mode_toggle" title="简洁模式会使用简洁款皮肤显示所有博客">
    简洁模式 <img id="navbar_lite_mode_on" src="/images/lite-mode-check.svg" class="hide" /><span id="navbar_lite_mode_spinner" class="hide">...</span>
</a>
                            <a href="javascript:void(0)" onclick="account.logout();">退出登录</a>
                        </div>
                    </div>
                    <a class="navbar-anonymous" href="https://account.cnblogs.com/signup/">注册</a>
                    <a class="navbar-anonymous" href="javascript:void(0);" onclick="account.login()">登录</a>
                </li>
            </ul>
        </nav>
    </div>

    
    <!--done-->
<div id="home">
<div id="header">
	<div id="blogTitle">
        <a id="lnkBlogLogo" href="https://www.cnblogs.com/cjsblog/"><img id="blogLogo" src="/skins/custom/images/logo.gif" alt="返回主页" /></a>		
		
<!--done-->
<h1><a id="Header1_HeaderTitle" class="headermaintitle HeaderMainTitle" href="https://www.cnblogs.com/cjsblog/">狂乱的贵公子</a>
</h1>
<h2>为你，千千万万遍！</h2>




		
	</div><!--end: blogTitle 博客的标题和副标题 -->
	<div id="navigator">
		
<ul id="navList">
<li><a id="blog_nav_sitehome" class="menu" href="https://www.cnblogs.com/">
博客园</a>
</li>
<li>
<a id="blog_nav_myhome" class="menu" href="https://www.cnblogs.com/cjsblog/">
首页</a>
</li>
<li>

<a id="blog_nav_newpost" class="menu" href="https://i.cnblogs.com/EditPosts.aspx?opt=1">
新随笔</a>
</li>
<li>
<a id="blog_nav_contact" class="menu" href="https://msg.cnblogs.com/send/%E5%BA%9F%E7%89%A9%E5%A4%A7%E5%B8%88%E5%85%84">
联系</a></li>
<li>
<a id="blog_nav_rss" class="menu" href="javascript:void(0)" data-rss="https://www.cnblogs.com/cjsblog/rss/">
订阅</a>
<!--<partial name="./Shared/_XmlLink.cshtml" model="Model" /></li>--></li>
<li>
<a id="blog_nav_admin" class="menu" href="https://i.cnblogs.com/">
管理</a>
</li>
</ul>


		<div class="blogStats">
			<div id="blog_stats_place_holder"><script>loadBlogStats();</script></div>
		</div><!--end: blogStats -->
	</div><!--end: navigator 博客导航栏 -->
</div><!--end: header 头部 -->
<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		<div id="post_detail">
    <!--done-->
    <div id="topics">
        <div class="post">
            <h1 class = "postTitle">
                
<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/cjsblog/p/14904861.html">
    <span>基于 Spring Security 的前后端分离的权限控制系统</span>
    



</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p><span style="font-size: 16px">话不多说，入正题。一个简单的权限控制系统需要考虑的问题如下：</span></p>
<ol>
<li><span style="font-size: 16px">权限如何加载</span></li>
<li><span style="font-size: 16px">权限匹配规则</span></li>
<li><span style="font-size: 16px">登录</span></li>
</ol>
<p style="color: inherit; line-height: inherit; padding: 0; margin: 1.6em 0; font-weight: bold; border-bottom: 2px solid rgba(104, 161, 90, 1); font-size: 1.6em"><span style="font-size: inherit; line-height: inherit; margin: 0 3px 0 0; display: inline-block; font-weight: normal; background: rgba(104, 161, 90, 1); color: rgba(255, 255, 255, 1); padding: 3px 10px 1px; border-top-right-radius: 3px; border-top-left-radius: 3px">1.&nbsp; 引入maven依赖</span></p>
<div class="highlight" style="background: rgba(248, 248, 248, 1)">
<pre><span style="font-size: 15px"><span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 1</span> <span style="color: rgba(188, 122, 0, 1)">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 2</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;project</span> <span style="color: rgba(125, 144, 41, 1)">xmlns=</span><span style="color: rgba(186, 33, 33, 1)">"http://maven.apache.org/POM/4.0.0"</span> <span style="color: rgba(125, 144, 41, 1)">xmlns:xsi=</span><span style="color: rgba(186, 33, 33, 1)">"http://www.w3.org/2001/XMLSchema-instance"</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 3</span>          <span style="color: rgba(125, 144, 41, 1)">xsi:schemaLocation=</span><span style="color: rgba(186, 33, 33, 1)">"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span style="color: rgba(0, 128, 0, 1); font-weight: bold">&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 4</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;modelVersion&gt;</span>4.0.0<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/modelVersion&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 5</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;parent&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 6</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;groupId&gt;</span>org.springframework.boot<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/groupId&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 7</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;artifactId&gt;</span>spring-boot-starter-parent<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/artifactId&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 8</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;version&gt;</span>2.5.1<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/version&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 9</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;relativePath/&gt;</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">&lt;!-- lookup parent from repository --&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">10</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/parent&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">11</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;groupId&gt;</span>com.example<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/groupId&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">12</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;artifactId&gt;</span>demo5<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/artifactId&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">13</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;version&gt;</span>0.0.1-SNAPSHOT<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/version&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">14</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;name&gt;</span>demo5<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/name&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">15</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">16</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;properties&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">17</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;java.version&gt;</span>1.8<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/java.version&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">18</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/properties&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">19</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">20</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;dependencies&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">21</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;dependency&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">22</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;groupId&gt;</span>org.springframework.boot<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/groupId&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">23</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;artifactId&gt;</span>spring-boot-starter-data-jpa<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/artifactId&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">24</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/dependency&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">25</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;dependency&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">26</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;groupId&gt;</span>org.springframework.boot<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/groupId&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">27</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;artifactId&gt;</span>spring-boot-starter-data-redis<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/artifactId&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">28</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/dependency&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">29</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;dependency&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">30</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;groupId&gt;</span>org.springframework.boot<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/groupId&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">31</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;artifactId&gt;</span>spring-boot-starter-security<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/artifactId&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">32</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/dependency&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">33</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;dependency&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">34</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;groupId&gt;</span>org.springframework.boot<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/groupId&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">35</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;artifactId&gt;</span>spring-boot-starter-web<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/artifactId&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">36</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/dependency&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">37</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">38</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;dependency&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">39</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;groupId&gt;</span>io.jsonwebtoken<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/groupId&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">40</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;artifactId&gt;</span>jjwt<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/artifactId&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">41</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;version&gt;</span>0.9.1<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/version&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">42</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/dependency&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">43</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">44</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;dependency&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">45</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;groupId&gt;</span>com.alibaba<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/groupId&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">46</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;artifactId&gt;</span>fastjson<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/artifactId&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">47</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;version&gt;</span>1.2.76<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/version&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">48</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/dependency&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">49</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;dependency&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">50</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;groupId&gt;</span>org.apache.commons<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/groupId&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">51</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;artifactId&gt;</span>commons-lang3<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/artifactId&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">52</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;version&gt;</span>3.12.0<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/version&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">53</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/dependency&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">54</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;dependency&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">55</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;groupId&gt;</span>commons-codec<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/groupId&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">56</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;artifactId&gt;</span>commons-codec<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/artifactId&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">57</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;version&gt;</span>1.15<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/version&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">58</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/dependency&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">59</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">60</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;dependency&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">61</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;groupId&gt;</span>mysql<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/groupId&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">62</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;artifactId&gt;</span>mysql-connector-java<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/artifactId&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">63</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;scope&gt;</span>runtime<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/scope&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">64</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/dependency&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">65</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;dependency&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">66</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;groupId&gt;</span>org.projectlombok<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/groupId&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">67</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;artifactId&gt;</span>lombok<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/artifactId&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">68</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;optional&gt;</span>true<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/optional&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">69</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/dependency&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">70</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/dependencies&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">71</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">72</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;build&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">73</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;plugins&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">74</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;plugin&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">75</span>                 <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;groupId&gt;</span>org.springframework.boot<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/groupId&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">76</span>                 <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/artifactId&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">77</span>                 <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;configuration&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">78</span>                     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;excludes&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">79</span>                         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;exclude&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">80</span>                             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;groupId&gt;</span>org.projectlombok<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/groupId&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">81</span>                             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;artifactId&gt;</span>lombok<span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/artifactId&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">82</span>                         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/exclude&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">83</span>                     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/excludes&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">84</span>                 <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/configuration&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">85</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/plugin&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">86</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/plugins&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">87</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/build&gt;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">88</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">89</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">&lt;/project&gt;</span></span></pre>
</div>
<p><span style="font-size: 16px">application.properties配置</span></p>
<div class="highlight" style="background: rgba(248, 248, 248, 1)">
<pre><span style="font-size: 15px"><span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 1</span> server.port<span style="color: rgba(125, 144, 41, 1)">=</span><span style="color: rgba(0, 128, 0, 1)">8080</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 2</span> server.servlet.context-path<span style="color: rgba(125, 144, 41, 1)">=</span><span style="color: rgba(0, 128, 0, 1)">/demo</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 3</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 4</span> spring.datasource.driver-class-name<span style="color: rgba(125, 144, 41, 1)">=</span><span style="color: rgba(0, 128, 0, 1)">com.mysql.jdbc.Driver</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 5</span> spring.datasource.url<span style="color: rgba(102, 102, 102, 1)">=</span><span style="color: rgba(0, 128, 0, 1)">jdbc:mysql://localhost:3306/demo?useUnicode=true&amp;characterEncoding=utf8</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 6</span> spring.datasource.username<span style="color: rgba(125, 144, 41, 1)">=</span>root
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 7</span> spring.datasource.password<span style="color: rgba(125, 144, 41, 1)">=</span><span style="color: rgba(0, 128, 0, 1)">123456</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 8</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 9</span> spring.jpa.database<span style="color: rgba(102, 102, 102, 1)">=</span><span style="color: rgba(0, 128, 0, 1)">mysql</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">10</span> spring.jpa.open-in-view<span style="color: rgba(125, 144, 41, 1)">=</span><span style="color: rgba(0, 128, 0, 1)">true</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">11</span> spring.jpa.properties.hibernate.enable_lazy_load_no_trans<span style="color: rgba(125, 144, 41, 1)">=</span><span style="color: rgba(0, 128, 0, 1)">true</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">12</span> spring.jpa.show-sql<span style="color: rgba(102, 102, 102, 1)">=</span><span style="color: rgba(0, 128, 0, 1)">true</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">13</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">14</span> spring.redis.host<span style="color: rgba(125, 144, 41, 1)">=</span><span style="color: rgba(0, 128, 0, 1)">192.168.28.31</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">15</span> spring.redis.port<span style="color: rgba(125, 144, 41, 1)">=</span><span style="color: rgba(0, 128, 0, 1)">6379</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">16</span> spring.redis.password<span style="color: rgba(125, 144, 41, 1)">=</span><span style="color: rgba(0, 128, 0, 1)">123456</span></span></pre>
</div>
<p style="color: inherit; line-height: inherit; padding: 0; margin: 1.6em 0; font-weight: bold; border-bottom: 2px solid rgba(104, 161, 90, 1); font-size: 1.6em"><span style="font-size: inherit; line-height: inherit; margin: 0 3px 0 0; display: inline-block; font-weight: normal; background: rgba(104, 161, 90, 1); color: rgba(255, 255, 255, 1); padding: 3px 10px 1px; border-top-right-radius: 3px; border-top-left-radius: 3px">2.&nbsp; 建表并生成相应的实体类</span></p>
<p><img src="https://img2020.cnblogs.com/blog/874963/202106/874963-20210619184414820-272983732.png" alt="" loading="lazy"></p>
<p><strong><span style="font-size: 16px">SysUser.java</span></strong></p>
<div class="highlight" style="background: rgba(248, 248, 248, 1)">
<pre><span style="font-size: 15px"><span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 1</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">package</span> <span style="color: rgba(125, 144, 41, 1)">com</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">example</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">demo5</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">entity</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 2</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 3</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">lombok.Getter</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 4</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">lombok.Setter</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 5</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 6</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">javax.persistence.*</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 7</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.io.Serializable</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 8</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.time.LocalDate</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 9</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.util.Set</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">10</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">11</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">/**</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">12</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * 用户表</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">13</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @Author ChengJianSheng</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">14</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @Date 2021/6/12</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">15</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> */</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">16</span> <span style="color: rgba(170, 34, 255, 1)">@Setter</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">17</span> <span style="color: rgba(170, 34, 255, 1)">@Getter</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">18</span> <span style="color: rgba(170, 34, 255, 1)">@Entity</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">19</span> <span style="color: rgba(170, 34, 255, 1)">@Table</span><span style="color: rgba(102, 102, 102, 1)">(</span>name <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"sys_user"</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">20</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">class</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">SysUserEntity</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">implements</span> Serializable <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">21</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">22</span>     <span style="color: rgba(170, 34, 255, 1)">@Id</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">23</span>     <span style="color: rgba(170, 34, 255, 1)">@GeneratedValue</span><span style="color: rgba(102, 102, 102, 1)">(</span>strategy <span style="color: rgba(102, 102, 102, 1)">=</span> GenerationType<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">AUTO</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">24</span>     <span style="color: rgba(170, 34, 255, 1)">@Column</span><span style="color: rgba(102, 102, 102, 1)">(</span>name <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"id"</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">25</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> Integer id<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">26</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">27</span>     <span style="color: rgba(170, 34, 255, 1)">@Column</span><span style="color: rgba(102, 102, 102, 1)">(</span>name <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"username"</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">28</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> String username<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">29</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">30</span>     <span style="color: rgba(170, 34, 255, 1)">@Column</span><span style="color: rgba(102, 102, 102, 1)">(</span>name <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"password"</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">31</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> String password<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">32</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">33</span>     <span style="color: rgba(170, 34, 255, 1)">@Column</span><span style="color: rgba(102, 102, 102, 1)">(</span>name <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"mobile"</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">34</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> String mobile<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">35</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">36</span>     <span style="color: rgba(170, 34, 255, 1)">@Column</span><span style="color: rgba(102, 102, 102, 1)">(</span>name <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"enabled"</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">37</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> Integer enabled<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">38</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">39</span>     <span style="color: rgba(170, 34, 255, 1)">@Column</span><span style="color: rgba(102, 102, 102, 1)">(</span>name <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"create_time"</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">40</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> LocalDate createTime<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">41</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">42</span>     <span style="color: rgba(170, 34, 255, 1)">@Column</span><span style="color: rgba(102, 102, 102, 1)">(</span>name <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"update_time"</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">43</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> LocalDate updateTime<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">44</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">45</span>     <span style="color: rgba(170, 34, 255, 1)">@OneToOne</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">46</span>     <span style="color: rgba(170, 34, 255, 1)">@JoinColumn</span><span style="color: rgba(102, 102, 102, 1)">(</span>name <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"dept_id"</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">47</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> SysDeptEntity dept<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">48</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">49</span>     <span style="color: rgba(170, 34, 255, 1)">@ManyToMany</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">50</span>     <span style="color: rgba(170, 34, 255, 1)">@JoinTable</span><span style="color: rgba(102, 102, 102, 1)">(</span>name <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"sys_user_role"</span><span style="color: rgba(102, 102, 102, 1)">,</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">51</span>             joinColumns <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(102, 102, 102, 1)">{</span><span style="color: rgba(170, 34, 255, 1)">@JoinColumn</span><span style="color: rgba(102, 102, 102, 1)">(</span>name <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"user_id"</span><span style="color: rgba(102, 102, 102, 1)">,</span> referencedColumnName <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"id"</span><span style="color: rgba(102, 102, 102, 1)">)},</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">52</span>             inverseJoinColumns <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(102, 102, 102, 1)">{</span><span style="color: rgba(170, 34, 255, 1)">@JoinColumn</span><span style="color: rgba(102, 102, 102, 1)">(</span>name <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"role_id"</span><span style="color: rgba(102, 102, 102, 1)">,</span> referencedColumnName <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"id"</span><span style="color: rgba(102, 102, 102, 1)">)})</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">53</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> Set<span style="color: rgba(102, 102, 102, 1)">&lt;</span>SysRoleEntity<span style="color: rgba(102, 102, 102, 1)">&gt;</span> roles<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">54</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">55</span> <span style="color: rgba(102, 102, 102, 1)">}</span>
</span></pre>
</div>
<p><strong><span style="font-size: 16px">SysDept.java</span></strong></p>
<p><span style="font-size: 16px">部门相当于用户组，这里简化了一下，用户组没有跟角色管理</span></p>
<div class="highlight" style="background: rgba(248, 248, 248, 1)">
<pre><span style="font-size: 15px"><span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 1</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">package</span> <span style="color: rgba(125, 144, 41, 1)">com</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">example</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">demo5</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">entity</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 2</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 3</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">lombok.Data</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 4</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 5</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">javax.persistence.*</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 6</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.io.Serializable</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 7</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.util.Set</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 8</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 9</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">/**</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">10</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * 部门表</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">11</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @Author ChengJianSheng</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">12</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @Date 2021/6/12</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">13</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> */</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">14</span> <span style="color: rgba(170, 34, 255, 1)">@Data</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">15</span> <span style="color: rgba(170, 34, 255, 1)">@Entity</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">16</span> <span style="color: rgba(170, 34, 255, 1)">@Table</span><span style="color: rgba(102, 102, 102, 1)">(</span>name <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"sys_dept"</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">17</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">class</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">SysDeptEntity</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">implements</span> Serializable <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">18</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">19</span>     <span style="color: rgba(170, 34, 255, 1)">@Id</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">20</span>     <span style="color: rgba(170, 34, 255, 1)">@GeneratedValue</span><span style="color: rgba(102, 102, 102, 1)">(</span>strategy <span style="color: rgba(102, 102, 102, 1)">=</span> GenerationType<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">AUTO</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">21</span>     <span style="color: rgba(170, 34, 255, 1)">@Column</span><span style="color: rgba(102, 102, 102, 1)">(</span>name <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"id"</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">22</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> Integer id<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">23</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">24</span>     <span style="color: rgba(64, 128, 128, 1); font-style: italic">/**</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">25</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">     * 部门名称</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">26</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">     */</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">27</span>     <span style="color: rgba(170, 34, 255, 1)">@Column</span><span style="color: rgba(102, 102, 102, 1)">(</span>name <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"name"</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">28</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> String name<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">29</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">30</span>     <span style="color: rgba(64, 128, 128, 1); font-style: italic">/**</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">31</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">     * 父级部门ID</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">32</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">     */</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">33</span>     <span style="color: rgba(170, 34, 255, 1)">@Column</span><span style="color: rgba(102, 102, 102, 1)">(</span>name <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"pid"</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">34</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> Integer pid<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">35</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">36</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">//    @ManyToMany(mappedBy = "depts")</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">37</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">//    private Set&lt;SysRoleEntity&gt; roles;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">38</span> <span style="color: rgba(102, 102, 102, 1)">}</span></span></pre>
</div>
<p><strong><span style="font-size: 16px">SysMenu.java</span></strong></p>
<p><span style="font-size: 16px">菜单相当于权限</span></p>
<div class="highlight" style="background: rgba(248, 248, 248, 1)">
<pre><span style="font-size: 15px"><span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 1</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">package</span> <span style="color: rgba(125, 144, 41, 1)">com</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">example</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">demo5</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">entity</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 2</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 3</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">lombok.Data</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 4</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">lombok.Getter</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 5</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">lombok.Setter</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 6</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 7</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">javax.persistence.*</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 8</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.io.Serializable</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 9</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.util.Set</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">10</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">11</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">/**</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">12</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * 菜单表</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">13</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @Author ChengJianSheng</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">14</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @Date 2021/6/12</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">15</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> */</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">16</span> <span style="color: rgba(170, 34, 255, 1)">@Setter</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">17</span> <span style="color: rgba(170, 34, 255, 1)">@Getter</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">18</span> <span style="color: rgba(170, 34, 255, 1)">@Entity</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">19</span> <span style="color: rgba(170, 34, 255, 1)">@Table</span><span style="color: rgba(102, 102, 102, 1)">(</span>name <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"sys_menu"</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">20</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">class</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">SysMenuEntity</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">implements</span> Serializable <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">21</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">22</span>     <span style="color: rgba(170, 34, 255, 1)">@Id</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">23</span>     <span style="color: rgba(170, 34, 255, 1)">@GeneratedValue</span><span style="color: rgba(102, 102, 102, 1)">(</span>strategy <span style="color: rgba(102, 102, 102, 1)">=</span> GenerationType<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">AUTO</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">24</span>     <span style="color: rgba(170, 34, 255, 1)">@Column</span><span style="color: rgba(102, 102, 102, 1)">(</span>name <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"id"</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">25</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> Integer id<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">26</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">27</span>     <span style="color: rgba(64, 128, 128, 1); font-style: italic">/**</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">28</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">     * 资源编码</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">29</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">     */</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">30</span>     <span style="color: rgba(170, 34, 255, 1)">@Column</span><span style="color: rgba(102, 102, 102, 1)">(</span>name <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"code"</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">31</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> String code<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">32</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">33</span>     <span style="color: rgba(64, 128, 128, 1); font-style: italic">/**</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">34</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">     * 资源名称</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">35</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">     */</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">36</span>     <span style="color: rgba(170, 34, 255, 1)">@Column</span><span style="color: rgba(102, 102, 102, 1)">(</span>name <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"name"</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">37</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> String name<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">38</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">39</span>     <span style="color: rgba(64, 128, 128, 1); font-style: italic">/**</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">40</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">     * 菜单/按钮URL</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">41</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">     */</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">42</span>     <span style="color: rgba(170, 34, 255, 1)">@Column</span><span style="color: rgba(102, 102, 102, 1)">(</span>name <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"url"</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">43</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> String url<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">44</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">45</span>     <span style="color: rgba(64, 128, 128, 1); font-style: italic">/**</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">46</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">     * 资源类型（1:菜单，2:按钮）</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">47</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">     */</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">48</span>     <span style="color: rgba(170, 34, 255, 1)">@Column</span><span style="color: rgba(102, 102, 102, 1)">(</span>name <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"type"</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">49</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> Integer type<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">50</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">51</span>     <span style="color: rgba(64, 128, 128, 1); font-style: italic">/**</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">52</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">     * 父级菜单ID</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">53</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">     */</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">54</span>     <span style="color: rgba(170, 34, 255, 1)">@Column</span><span style="color: rgba(102, 102, 102, 1)">(</span>name <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"pid"</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">55</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> Integer pid<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">56</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">57</span>     <span style="color: rgba(64, 128, 128, 1); font-style: italic">/**</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">58</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">     * 排序号</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">59</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">     */</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">60</span>     <span style="color: rgba(170, 34, 255, 1)">@Column</span><span style="color: rgba(102, 102, 102, 1)">(</span>name <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"sort"</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">61</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> Integer sort<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">62</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">63</span>     <span style="color: rgba(170, 34, 255, 1)">@ManyToMany</span><span style="color: rgba(102, 102, 102, 1)">(</span>mappedBy <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"menus"</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">64</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> Set<span style="color: rgba(102, 102, 102, 1)">&lt;</span>SysRoleEntity<span style="color: rgba(102, 102, 102, 1)">&gt;</span> roles<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">65</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">66</span> <span style="color: rgba(102, 102, 102, 1)">}</span></span></pre>
</div>
<p><strong><span style="font-size: 16px">SysRole.java</span></strong></p>
<div class="highlight" style="background: rgba(248, 248, 248, 1)">
<pre><span style="font-size: 15px"><span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 1</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">package</span> <span style="color: rgba(125, 144, 41, 1)">com</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">example</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">demo5</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">entity</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 2</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 3</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">lombok.Data</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 4</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">lombok.Getter</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 5</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">lombok.Setter</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 6</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 7</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">javax.persistence.*</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 8</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.io.Serializable</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 9</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.util.Set</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">10</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">11</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">/**</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">12</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * 角色表</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">13</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @Author ChengJianSheng</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">14</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @Date 2021/6/12</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">15</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> */</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">16</span> <span style="color: rgba(170, 34, 255, 1)">@Setter</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">17</span> <span style="color: rgba(170, 34, 255, 1)">@Getter</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">18</span> <span style="color: rgba(170, 34, 255, 1)">@Entity</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">19</span> <span style="color: rgba(170, 34, 255, 1)">@Table</span><span style="color: rgba(102, 102, 102, 1)">(</span>name <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"sys_role"</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">20</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">class</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">SysRoleEntity</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">implements</span> Serializable <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">21</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">22</span>     <span style="color: rgba(170, 34, 255, 1)">@Id</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">23</span>     <span style="color: rgba(170, 34, 255, 1)">@GeneratedValue</span><span style="color: rgba(102, 102, 102, 1)">(</span>strategy <span style="color: rgba(102, 102, 102, 1)">=</span> GenerationType<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">AUTO</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">24</span>     <span style="color: rgba(170, 34, 255, 1)">@Column</span><span style="color: rgba(102, 102, 102, 1)">(</span>name <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"id"</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">25</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> Integer id<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">26</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">27</span>     <span style="color: rgba(64, 128, 128, 1); font-style: italic">/**</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">28</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">     * 角色名称</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">29</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">     */</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">30</span>     <span style="color: rgba(170, 34, 255, 1)">@Column</span><span style="color: rgba(102, 102, 102, 1)">(</span>name <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"name"</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">31</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> String name<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">32</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">33</span>     <span style="color: rgba(170, 34, 255, 1)">@ManyToMany</span><span style="color: rgba(102, 102, 102, 1)">(</span>mappedBy <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"roles"</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">34</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> Set<span style="color: rgba(102, 102, 102, 1)">&lt;</span>SysUserEntity<span style="color: rgba(102, 102, 102, 1)">&gt;</span> users<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">35</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">36</span>     <span style="color: rgba(170, 34, 255, 1)">@ManyToMany</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">37</span>     <span style="color: rgba(170, 34, 255, 1)">@JoinTable</span><span style="color: rgba(102, 102, 102, 1)">(</span>name <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"sys_role_menu"</span><span style="color: rgba(102, 102, 102, 1)">,</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">38</span>             joinColumns <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(102, 102, 102, 1)">{</span><span style="color: rgba(170, 34, 255, 1)">@JoinColumn</span><span style="color: rgba(102, 102, 102, 1)">(</span>name <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"role_id"</span><span style="color: rgba(102, 102, 102, 1)">,</span> referencedColumnName <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"id"</span><span style="color: rgba(102, 102, 102, 1)">)},</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">39</span>             inverseJoinColumns <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(102, 102, 102, 1)">{</span><span style="color: rgba(170, 34, 255, 1)">@JoinColumn</span><span style="color: rgba(102, 102, 102, 1)">(</span>name <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"menu_id"</span><span style="color: rgba(102, 102, 102, 1)">,</span> referencedColumnName <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"id"</span><span style="color: rgba(102, 102, 102, 1)">)})</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">40</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> Set<span style="color: rgba(102, 102, 102, 1)">&lt;</span>SysMenuEntity<span style="color: rgba(102, 102, 102, 1)">&gt;</span> menus<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">41</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">42</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">//    @ManyToMany</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">43</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">//    @JoinTable(name = "sys_dept_role",</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">44</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">//            joinColumns = {@JoinColumn(name = "role_id", referencedColumnName = "id")},</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">45</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">//            inverseJoinColumns = {@JoinColumn(name = "dept_id", referencedColumnName = "id")})</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">46</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">//    private Set&lt;SysDeptEntity&gt; depts;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">47</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">48</span> <span style="color: rgba(102, 102, 102, 1)">}</span>
</span></pre>
</div>
<p><span style="font-size: 16px">注意，不要使用@Data注解，因为@Data包含@ToString注解</span></p>
<p><span style="font-size: 16px">不要随便打印SysUser，例如：System.out.println(sysUser); 任何形式的toString()调用都不要有，否则很有可能造成循环调用，死递归。想想看，SysUser里面要查SysRole，SysRole要查SysMenu，SysMenu又要查SysRole。除非不用懒加载。</span></p>
<p><img src="https://img2020.cnblogs.com/blog/874963/202106/874963-20210619202505356-1770686962.png" alt="" loading="lazy"></p>
<p style="color: inherit; line-height: inherit; padding: 0; margin: 1.6em 0; font-weight: bold; border-bottom: 2px solid rgba(104, 161, 90, 1); font-size: 1.6em"><span style="font-size: inherit; line-height: inherit; margin: 0 3px 0 0; display: inline-block; font-weight: normal; background: rgba(104, 161, 90, 1); color: rgba(255, 255, 255, 1); padding: 3px 10px 1px; border-top-right-radius: 3px; border-top-left-radius: 3px">3.&nbsp; 自定义UserDetails</span></p>
<p><span style="font-size: 16px">虽然可以使用Spring Security自带的User，但是笔者还是强烈建议自定义一个UserDetails，后面可以直接将其序列化成json缓存到redis中</span></p>
<div class="highlight" style="background: rgba(248, 248, 248, 1)">
<pre><span style="font-size: 15px"><span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 1</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">package</span> <span style="color: rgba(125, 144, 41, 1)">com</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">example</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">demo5</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">domain</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 2</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 3</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">lombok.Setter</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 4</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.core.GrantedAuthority</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 5</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.core.authority.SimpleGrantedAuthority</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 6</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.core.userdetails.User</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 7</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.core.userdetails.UserDetails</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 8</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 9</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.util.Collection</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">10</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.util.Set</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">11</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">12</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">/**</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">13</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @Author ChengJianSheng</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">14</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @Date 2021/6/12</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">15</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @see User</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">16</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @see org.springframework.security.core.userdetails.User</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">17</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> */</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">18</span> <span style="color: rgba(170, 34, 255, 1)">@Setter</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">19</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">class</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">MyUserDetails</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">implements</span> UserDetails <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">20</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">21</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> String username<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">22</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> String password<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">23</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> <span style="color: rgba(176, 0, 64, 1)">boolean</span> enabled<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">24</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">//    private Collection&lt;? extends GrantedAuthority&gt; authorities;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">25</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> Set<span style="color: rgba(102, 102, 102, 1)">&lt;</span>SimpleGrantedAuthority<span style="color: rgba(102, 102, 102, 1)">&gt;</span> authorities<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">26</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">27</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 0, 255, 1)">MyUserDetails</span><span style="color: rgba(102, 102, 102, 1)">(</span>String username<span style="color: rgba(102, 102, 102, 1)">,</span> String password<span style="color: rgba(102, 102, 102, 1)">,</span> <span style="color: rgba(176, 0, 64, 1)">boolean</span> enabled<span style="color: rgba(102, 102, 102, 1)">,</span> Set<span style="color: rgba(102, 102, 102, 1)">&lt;</span>SimpleGrantedAuthority<span style="color: rgba(102, 102, 102, 1)">&gt;</span> authorities<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">28</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">this</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">username</span> <span style="color: rgba(102, 102, 102, 1)">=</span> username<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">29</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">this</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">password</span> <span style="color: rgba(102, 102, 102, 1)">=</span> password<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">30</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">this</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">enabled</span> <span style="color: rgba(102, 102, 102, 1)">=</span> enabled<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">31</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">this</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">authorities</span> <span style="color: rgba(102, 102, 102, 1)">=</span> authorities<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">32</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">33</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">34</span>     <span style="color: rgba(170, 34, 255, 1)">@Override</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">35</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> Collection<span style="color: rgba(102, 102, 102, 1)">&lt;?</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">extends</span> GrantedAuthority<span style="color: rgba(102, 102, 102, 1)">&gt;</span> getAuthorities<span style="color: rgba(102, 102, 102, 1)">()</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">36</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">return</span> authorities<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">37</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">38</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">39</span>     <span style="color: rgba(170, 34, 255, 1)">@Override</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">40</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> String <span style="color: rgba(0, 0, 255, 1)">getPassword</span><span style="color: rgba(102, 102, 102, 1)">()</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">41</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">return</span> password<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">42</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">43</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">44</span>     <span style="color: rgba(170, 34, 255, 1)">@Override</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">45</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> String <span style="color: rgba(0, 0, 255, 1)">getUsername</span><span style="color: rgba(102, 102, 102, 1)">()</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">46</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">return</span> username<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">47</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">48</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">49</span>     <span style="color: rgba(170, 34, 255, 1)">@Override</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">50</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(176, 0, 64, 1)">boolean</span> <span style="color: rgba(0, 0, 255, 1)">isAccountNonExpired</span><span style="color: rgba(102, 102, 102, 1)">()</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">51</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">return</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">true</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">52</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">53</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">54</span>     <span style="color: rgba(170, 34, 255, 1)">@Override</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">55</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(176, 0, 64, 1)">boolean</span> <span style="color: rgba(0, 0, 255, 1)">isAccountNonLocked</span><span style="color: rgba(102, 102, 102, 1)">()</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">56</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">return</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">true</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">57</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">58</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">59</span>     <span style="color: rgba(170, 34, 255, 1)">@Override</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">60</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(176, 0, 64, 1)">boolean</span> <span style="color: rgba(0, 0, 255, 1)">isCredentialsNonExpired</span><span style="color: rgba(102, 102, 102, 1)">()</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">61</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">return</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">true</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">62</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">63</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">64</span>     <span style="color: rgba(170, 34, 255, 1)">@Override</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">65</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(176, 0, 64, 1)">boolean</span> <span style="color: rgba(0, 0, 255, 1)">isEnabled</span><span style="color: rgba(102, 102, 102, 1)">()</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">66</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">return</span> enabled<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">67</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">68</span> <span style="color: rgba(102, 102, 102, 1)">}</span></span></pre>
</div>
<p>&nbsp;<span style="font-size: 16px">都自定义UserDetails了，当然要自己实现UserDetailsService了。这里当时偷懒直接用自带的User，后面放缓存的时候才知道不方便。</span></p>
<div class="highlight" style="background: rgba(248, 248, 248, 1)">
<pre><span style="font-size: 15px"><span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 1</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">package</span> <span style="color: rgba(125, 144, 41, 1)">com</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">example</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">demo5</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">service</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 2</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 3</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.example.demo5.entity.SysMenuEntity</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 4</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.example.demo5.entity.SysRoleEntity</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 5</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.example.demo5.entity.SysUserEntity</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 6</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.example.demo5.repository.SysUserRepository</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 7</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.apache.commons.lang3.StringUtils</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 8</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.core.authority.SimpleGrantedAuthority</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 9</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.core.userdetails.User</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">10</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.core.userdetails.UserDetails</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">11</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.core.userdetails.UserDetailsService</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">12</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.core.userdetails.UsernameNotFoundException</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">13</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.stereotype.Service</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">14</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">15</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">javax.annotation.Resource</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">16</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.util.Set</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">17</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.util.stream.Collectors</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">18</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">19</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">/**</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">20</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @Author ChengJianSheng</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">21</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @Date 2021/6/12</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">22</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> */</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">23</span> <span style="color: rgba(170, 34, 255, 1)">@Service</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">24</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">class</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">MyUserDetailsService</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">implements</span> UserDetailsService <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">25</span>     <span style="color: rgba(170, 34, 255, 1)">@Resource</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">26</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> SysUserRepository sysUserRepository<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">27</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">28</span>     <span style="color: rgba(170, 34, 255, 1)">@Override</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">29</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> UserDetails <span style="color: rgba(0, 0, 255, 1)">loadUserByUsername</span><span style="color: rgba(102, 102, 102, 1)">(</span>String username<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">throws</span> UsernameNotFoundException <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">30</span>         SysUserEntity sysUserEntity <span style="color: rgba(102, 102, 102, 1)">=</span> sysUserRepository<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">findByUsername</span><span style="color: rgba(102, 102, 102, 1)">(</span>username<span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">31</span>         Set<span style="color: rgba(102, 102, 102, 1)">&lt;</span>SysRoleEntity<span style="color: rgba(102, 102, 102, 1)">&gt;</span> roleSet <span style="color: rgba(102, 102, 102, 1)">=</span> sysUserEntity<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getRoles</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">32</span>         Set<span style="color: rgba(102, 102, 102, 1)">&lt;</span>SimpleGrantedAuthority<span style="color: rgba(102, 102, 102, 1)">&gt;</span> authorities <span style="color: rgba(102, 102, 102, 1)">=</span> roleSet<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">stream</span><span style="color: rgba(102, 102, 102, 1)">().</span><span style="color: rgba(125, 144, 41, 1)">flatMap</span><span style="color: rgba(102, 102, 102, 1)">(</span>role<span style="color: rgba(102, 102, 102, 1)">-&gt;</span>role<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getMenus</span><span style="color: rgba(102, 102, 102, 1)">().</span><span style="color: rgba(125, 144, 41, 1)">stream</span><span style="color: rgba(102, 102, 102, 1)">())</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">33</span>                 <span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">filter</span><span style="color: rgba(102, 102, 102, 1)">(</span>menu<span style="color: rgba(102, 102, 102, 1)">-&gt;</span> StringUtils<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">isNotBlank</span><span style="color: rgba(102, 102, 102, 1)">(</span>menu<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getCode</span><span style="color: rgba(102, 102, 102, 1)">()))</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">34</span>                 <span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">map</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(160, 160, 0, 1)">SysMenuEntity:</span><span style="color: rgba(102, 102, 102, 1)">:</span>getCode<span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">35</span>                 <span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">map</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(160, 160, 0, 1)">SimpleGrantedAuthority:</span><span style="color: rgba(102, 102, 102, 1)">:</span><span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">36</span>                 <span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">collect</span><span style="color: rgba(102, 102, 102, 1)">(</span>Collectors<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">toSet</span><span style="color: rgba(102, 102, 102, 1)">());</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">37</span>         User user <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> User<span style="color: rgba(102, 102, 102, 1)">(</span>sysUserEntity<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getUsername</span><span style="color: rgba(102, 102, 102, 1)">(),</span> sysUserEntity<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getPassword</span><span style="color: rgba(102, 102, 102, 1)">(),</span> authorities<span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">38</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">return</span> user<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">39</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">40</span> <span style="color: rgba(102, 102, 102, 1)">}</span>
</span></pre>
</div>
<p><span style="font-size: 16px">算了，还是改过来吧</span></p>
<div class="highlight" style="background: rgba(248, 248, 248, 1)">
<pre><span style="font-size: 15px"><span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 1</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">package</span> <span style="color: rgba(125, 144, 41, 1)">com</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">example</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">demo5</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">service</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 2</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 3</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.example.demo5.domain.MyUserDetails</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 4</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.example.demo5.entity.SysMenuEntity</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 5</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.example.demo5.entity.SysRoleEntity</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 6</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.example.demo5.entity.SysUserEntity</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 7</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.example.demo5.repository.SysUserRepository</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 8</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.apache.commons.lang3.StringUtils</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 9</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.core.authority.SimpleGrantedAuthority</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">10</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.core.userdetails.User</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">11</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.core.userdetails.UserDetails</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">12</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.core.userdetails.UserDetailsService</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">13</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.core.userdetails.UsernameNotFoundException</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">14</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.stereotype.Service</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">15</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">16</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">javax.annotation.Resource</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">17</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.util.Set</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">18</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.util.stream.Collectors</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">19</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">20</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">/**</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">21</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @Author ChengJianSheng</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">22</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @Date 2021/6/12</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">23</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> */</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">24</span> <span style="color: rgba(170, 34, 255, 1)">@Service</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">25</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">class</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">MyUserDetailsService</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">implements</span> UserDetailsService <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">26</span>     <span style="color: rgba(170, 34, 255, 1)">@Resource</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">27</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> SysUserRepository sysUserRepository<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">28</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">29</span>     <span style="color: rgba(170, 34, 255, 1)">@Override</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">30</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> UserDetails <span style="color: rgba(0, 0, 255, 1)">loadUserByUsername</span><span style="color: rgba(102, 102, 102, 1)">(</span>String username<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">throws</span> UsernameNotFoundException <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">31</span>         SysUserEntity sysUserEntity <span style="color: rgba(102, 102, 102, 1)">=</span> sysUserRepository<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">findByUsername</span><span style="color: rgba(102, 102, 102, 1)">(</span>username<span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">32</span>         Set<span style="color: rgba(102, 102, 102, 1)">&lt;</span>SysRoleEntity<span style="color: rgba(102, 102, 102, 1)">&gt;</span> roleSet <span style="color: rgba(102, 102, 102, 1)">=</span> sysUserEntity<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getRoles</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">33</span>         Set<span style="color: rgba(102, 102, 102, 1)">&lt;</span>SimpleGrantedAuthority<span style="color: rgba(102, 102, 102, 1)">&gt;</span> authorities <span style="color: rgba(102, 102, 102, 1)">=</span> roleSet<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">stream</span><span style="color: rgba(102, 102, 102, 1)">().</span><span style="color: rgba(125, 144, 41, 1)">flatMap</span><span style="color: rgba(102, 102, 102, 1)">(</span>role<span style="color: rgba(102, 102, 102, 1)">-&gt;</span>role<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getMenus</span><span style="color: rgba(102, 102, 102, 1)">().</span><span style="color: rgba(125, 144, 41, 1)">stream</span><span style="color: rgba(102, 102, 102, 1)">())</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">34</span>                 <span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">filter</span><span style="color: rgba(102, 102, 102, 1)">(</span>menu<span style="color: rgba(102, 102, 102, 1)">-&gt;</span> StringUtils<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">isNotBlank</span><span style="color: rgba(102, 102, 102, 1)">(</span>menu<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getCode</span><span style="color: rgba(102, 102, 102, 1)">()))</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">35</span>                 <span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">map</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(160, 160, 0, 1)">SysMenuEntity:</span><span style="color: rgba(102, 102, 102, 1)">:</span>getCode<span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">36</span>                 <span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">map</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(160, 160, 0, 1)">SimpleGrantedAuthority:</span><span style="color: rgba(102, 102, 102, 1)">:</span><span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">37</span>                 <span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">collect</span><span style="color: rgba(102, 102, 102, 1)">(</span>Collectors<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">toSet</span><span style="color: rgba(102, 102, 102, 1)">());</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">38</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">//        return new User(sysUserEntity.getUsername(), sysUserEntity.getPassword(), authorities);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">39</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">return</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> <span style="color: rgba(0, 0, 255, 1)">MyUserDetails</span><span style="color: rgba(102, 102, 102, 1)">(</span>sysUserEntity<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getUsername</span><span style="color: rgba(102, 102, 102, 1)">(),</span> sysUserEntity<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getPassword</span><span style="color: rgba(102, 102, 102, 1)">(),</span> <span style="color: rgba(102, 102, 102, 1)">1==</span>sysUserEntity<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getEnabled</span><span style="color: rgba(102, 102, 102, 1)">(),</span> authorities<span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">40</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">41</span> <span style="color: rgba(102, 102, 102, 1)">}</span>
</span></pre>
</div>
<p style="color: inherit; line-height: inherit; padding: 0; margin: 1.6em 0; font-weight: bold; border-bottom: 2px solid rgba(104, 161, 90, 1); font-size: 1.6em"><span style="font-size: inherit; line-height: inherit; margin: 0 3px 0 0; display: inline-block; font-weight: normal; background: rgba(104, 161, 90, 1); color: rgba(255, 255, 255, 1); padding: 3px 10px 1px; border-top-right-radius: 3px; border-top-left-radius: 3px">4.&nbsp; 自定义各种Handler</span></p>
<p><span style="font-size: 16px">登录成功</span></p>
<div class="highlight" style="background: rgba(248, 248, 248, 1)">
<pre><span style="font-size: 15px"><span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 1</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">package</span> <span style="color: rgba(125, 144, 41, 1)">com</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">example</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">demo5</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">handler</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 2</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 3</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.alibaba.fastjson.JSON</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 4</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.example.demo5.domain.MyUserDetails</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 5</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.example.demo5.domain.RespResult</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 6</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.example.demo5.util.JwtUtils</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 7</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.fasterxml.jackson.databind.ObjectMapper</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 8</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.beans.factory.annotation.Autowired</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 9</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.data.redis.core.StringRedisTemplate</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">10</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.core.Authentication</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">11</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.web.authentication.SavedRequestAwareAuthenticationSuccessHandler</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">12</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.stereotype.Component</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">13</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">14</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">javax.servlet.ServletException</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">15</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">javax.servlet.http.HttpServletRequest</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">16</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">javax.servlet.http.HttpServletResponse</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">17</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.io.IOException</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">18</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.io.PrintWriter</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">19</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.util.concurrent.TimeUnit</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">20</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">21</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">/**</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">22</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * 登录成功</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">23</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> */</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">24</span> <span style="color: rgba(170, 34, 255, 1)">@Component</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">25</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">class</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">MyAuthenticationSuccessHandler</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">extends</span> SavedRequestAwareAuthenticationSuccessHandler <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">26</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">27</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">static</span> ObjectMapper objectMapper <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> ObjectMapper<span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">28</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">29</span>     <span style="color: rgba(170, 34, 255, 1)">@Autowired</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">30</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> StringRedisTemplate stringRedisTemplate<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">31</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">32</span>     <span style="color: rgba(170, 34, 255, 1)">@Override</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">33</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(176, 0, 64, 1)">void</span> <span style="color: rgba(0, 0, 255, 1)">onAuthenticationSuccess</span><span style="color: rgba(102, 102, 102, 1)">(</span>HttpServletRequest request<span style="color: rgba(102, 102, 102, 1)">,</span> HttpServletResponse response<span style="color: rgba(102, 102, 102, 1)">,</span> Authentication authentication<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">throws</span> ServletException<span style="color: rgba(102, 102, 102, 1)">,</span> IOException <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">34</span>         MyUserDetails user <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(102, 102, 102, 1)">(</span>MyUserDetails<span style="color: rgba(102, 102, 102, 1)">)</span> authentication<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getPrincipal</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">35</span>         String username <span style="color: rgba(102, 102, 102, 1)">=</span> user<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getUsername</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">36</span>         String token <span style="color: rgba(102, 102, 102, 1)">=</span> JwtUtils<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">createToken</span><span style="color: rgba(102, 102, 102, 1)">(</span>username<span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">37</span>         stringRedisTemplate<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">opsForValue</span><span style="color: rgba(102, 102, 102, 1)">().</span><span style="color: rgba(125, 144, 41, 1)">set</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(186, 33, 33, 1)">"TOKEN:"</span> <span style="color: rgba(102, 102, 102, 1)">+</span> token<span style="color: rgba(102, 102, 102, 1)">,</span> JSON<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">toJSONString</span><span style="color: rgba(102, 102, 102, 1)">(</span>user<span style="color: rgba(102, 102, 102, 1)">),</span> <span style="color: rgba(102, 102, 102, 1)">60,</span> TimeUnit<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">MINUTES</span><span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">38</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">39</span>         response<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">setContentType</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(186, 33, 33, 1)">"application/json;charset=utf-8"</span><span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">40</span>         PrintWriter writer <span style="color: rgba(102, 102, 102, 1)">=</span> response<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getWriter</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">41</span>         writer<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">write</span><span style="color: rgba(102, 102, 102, 1)">(</span>objectMapper<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">writeValueAsString</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> RespResult<span style="color: rgba(102, 102, 102, 1)">&lt;&gt;(1,</span> <span style="color: rgba(186, 33, 33, 1)">"success"</span><span style="color: rgba(102, 102, 102, 1)">,</span> token<span style="color: rgba(102, 102, 102, 1)">)));</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">42</span>         writer<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">flush</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">43</span>         writer<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">close</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">44</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">45</span> <span style="color: rgba(102, 102, 102, 1)">}</span></span></pre>
</div>
<p><span style="font-size: 16px">登录失败</span></p>
<div class="highlight" style="background: rgba(248, 248, 248, 1)">
<pre><span style="font-size: 15px"><span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 1</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">package</span> <span style="color: rgba(125, 144, 41, 1)">com</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">example</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">demo5</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">handler</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 2</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 3</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.example.demo5.domain.RespResult</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 4</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.fasterxml.jackson.databind.ObjectMapper</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 5</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.core.AuthenticationException</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 6</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.web.authentication.SimpleUrlAuthenticationFailureHandler</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 7</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.stereotype.Component</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 8</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 9</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">javax.servlet.ServletException</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">10</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">javax.servlet.http.HttpServletRequest</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">11</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">javax.servlet.http.HttpServletResponse</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">12</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.io.IOException</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">13</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.io.PrintWriter</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">14</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">15</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">/**</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">16</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * 登录失败</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">17</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> */</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">18</span> <span style="color: rgba(170, 34, 255, 1)">@Component</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">19</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">class</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">MyAuthenticationFailureHandler</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">extends</span> SimpleUrlAuthenticationFailureHandler <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">20</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">21</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">static</span> ObjectMapper objectMapper <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> ObjectMapper<span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">22</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">23</span>     <span style="color: rgba(170, 34, 255, 1)">@Override</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">24</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(176, 0, 64, 1)">void</span> <span style="color: rgba(0, 0, 255, 1)">onAuthenticationFailure</span><span style="color: rgba(102, 102, 102, 1)">(</span>HttpServletRequest request<span style="color: rgba(102, 102, 102, 1)">,</span> HttpServletResponse response<span style="color: rgba(102, 102, 102, 1)">,</span> AuthenticationException exception<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">throws</span> IOException<span style="color: rgba(102, 102, 102, 1)">,</span> ServletException <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">25</span>         response<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">setContentType</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(186, 33, 33, 1)">"application/json;charset=utf-8"</span><span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">26</span>         PrintWriter writer <span style="color: rgba(102, 102, 102, 1)">=</span> response<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getWriter</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">27</span>         writer<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">write</span><span style="color: rgba(102, 102, 102, 1)">(</span>objectMapper<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">writeValueAsString</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> RespResult<span style="color: rgba(102, 102, 102, 1)">&lt;&gt;(0,</span> exception<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getMessage</span><span style="color: rgba(102, 102, 102, 1)">(),</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">null</span><span style="color: rgba(102, 102, 102, 1)">)));</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">28</span>         writer<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">flush</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">29</span>         writer<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">close</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">30</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">31</span> <span style="color: rgba(102, 102, 102, 1)">}</span></span></pre>
</div>
<p><span style="font-size: 16px">未登录</span></p>
<div class="highlight" style="background: rgba(248, 248, 248, 1)">
<pre><span style="font-size: 15px"><span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 1</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">package</span> <span style="color: rgba(125, 144, 41, 1)">com</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">example</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">demo5</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">handler</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 2</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 3</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.example.demo5.domain.RespResult</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 4</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.fasterxml.jackson.databind.ObjectMapper</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 5</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.core.AuthenticationException</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 6</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.web.AuthenticationEntryPoint</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 7</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.stereotype.Component</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 8</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 9</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">javax.servlet.ServletException</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">10</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">javax.servlet.http.HttpServletRequest</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">11</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">javax.servlet.http.HttpServletResponse</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">12</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.io.IOException</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">13</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.io.PrintWriter</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">14</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">15</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">/**</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">16</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * 未认证（未登录）统一处理</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">17</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @Author ChengJianSheng</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">18</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @Date 2021/5/7</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">19</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> */</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">20</span> <span style="color: rgba(170, 34, 255, 1)">@Component</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">21</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">class</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">MyAuthenticationEntryPoint</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">implements</span> AuthenticationEntryPoint <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">22</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">23</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">static</span> ObjectMapper objectMapper <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> ObjectMapper<span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">24</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">25</span>     <span style="color: rgba(170, 34, 255, 1)">@Override</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">26</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(176, 0, 64, 1)">void</span> <span style="color: rgba(0, 0, 255, 1)">commence</span><span style="color: rgba(102, 102, 102, 1)">(</span>HttpServletRequest request<span style="color: rgba(102, 102, 102, 1)">,</span> HttpServletResponse response<span style="color: rgba(102, 102, 102, 1)">,</span> AuthenticationException authException<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">throws</span> IOException<span style="color: rgba(102, 102, 102, 1)">,</span> ServletException <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">27</span>         response<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">setContentType</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(186, 33, 33, 1)">"application/json;charset=utf-8"</span><span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">28</span>         PrintWriter writer <span style="color: rgba(102, 102, 102, 1)">=</span> response<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getWriter</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">29</span>         writer<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">write</span><span style="color: rgba(102, 102, 102, 1)">(</span>objectMapper<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">writeValueAsString</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> RespResult<span style="color: rgba(102, 102, 102, 1)">&lt;&gt;(0,</span> <span style="color: rgba(186, 33, 33, 1)">"未登录，请先登录"</span><span style="color: rgba(102, 102, 102, 1)">,</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">null</span><span style="color: rgba(102, 102, 102, 1)">)));</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">30</span>         writer<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">flush</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">31</span>         writer<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">close</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">32</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">33</span> <span style="color: rgba(102, 102, 102, 1)">}</span></span></pre>
</div>
<p><span style="font-size: 16px">未授权</span></p>
<div class="highlight" style="background: rgba(248, 248, 248, 1)">
<pre><span style="font-size: 15px"><span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 1</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">package</span> <span style="color: rgba(125, 144, 41, 1)">com</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">example</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">demo5</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">handler</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 2</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 3</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.example.demo5.domain.RespResult</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 4</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.fasterxml.jackson.databind.ObjectMapper</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 5</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.access.AccessDeniedException</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 6</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.web.access.AccessDeniedHandler</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 7</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.stereotype.Component</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 8</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 9</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">javax.servlet.ServletException</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">10</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">javax.servlet.http.HttpServletRequest</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">11</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">javax.servlet.http.HttpServletResponse</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">12</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.io.IOException</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">13</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.io.PrintWriter</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">14</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">15</span> <span style="color: rgba(170, 34, 255, 1)">@Component</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">16</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">class</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">MyAccessDeniedHandler</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">implements</span> AccessDeniedHandler <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">17</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">18</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">static</span> ObjectMapper objectMapper <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> ObjectMapper<span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">19</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">20</span>     <span style="color: rgba(170, 34, 255, 1)">@Override</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">21</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(176, 0, 64, 1)">void</span> <span style="color: rgba(0, 0, 255, 1)">handle</span><span style="color: rgba(102, 102, 102, 1)">(</span>HttpServletRequest request<span style="color: rgba(102, 102, 102, 1)">,</span> HttpServletResponse response<span style="color: rgba(102, 102, 102, 1)">,</span> AccessDeniedException accessDeniedException<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">throws</span> IOException<span style="color: rgba(102, 102, 102, 1)">,</span> ServletException <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">22</span>         response<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">setContentType</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(186, 33, 33, 1)">"application/json;charset=utf-8"</span><span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">23</span>         PrintWriter writer <span style="color: rgba(102, 102, 102, 1)">=</span> response<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getWriter</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">24</span>         writer<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">write</span><span style="color: rgba(102, 102, 102, 1)">(</span>objectMapper<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">writeValueAsString</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> RespResult<span style="color: rgba(102, 102, 102, 1)">&lt;&gt;(0,</span> <span style="color: rgba(186, 33, 33, 1)">"抱歉，您没有权限访问"</span><span style="color: rgba(102, 102, 102, 1)">,</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">null</span><span style="color: rgba(102, 102, 102, 1)">)));</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">25</span>         writer<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">flush</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">26</span>         writer<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">close</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">27</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">28</span> <span style="color: rgba(102, 102, 102, 1)">}</span></span></pre>
</div>
<p><span style="font-size: 16px">Session过期</span></p>
<div class="highlight" style="background: rgba(248, 248, 248, 1)">
<pre><span style="font-size: 15px"><span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 1</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">package</span> <span style="color: rgba(125, 144, 41, 1)">com</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">example</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">demo5</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">handler</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 2</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 3</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.example.demo5.domain.RespResult</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 4</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.fasterxml.jackson.databind.ObjectMapper</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 5</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.web.session.SessionInformationExpiredEvent</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 6</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.web.session.SessionInformationExpiredStrategy</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 7</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 8</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">javax.servlet.ServletException</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 9</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">javax.servlet.http.HttpServletResponse</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">10</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.io.IOException</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">11</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.io.PrintWriter</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">12</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">13</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">class</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">MyExpiredSessionStrategy</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">implements</span> SessionInformationExpiredStrategy <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">14</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">15</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">static</span> ObjectMapper objectMapper <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> ObjectMapper<span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">16</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">17</span>     <span style="color: rgba(170, 34, 255, 1)">@Override</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">18</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(176, 0, 64, 1)">void</span> <span style="color: rgba(0, 0, 255, 1)">onExpiredSessionDetected</span><span style="color: rgba(102, 102, 102, 1)">(</span>SessionInformationExpiredEvent event<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">throws</span> IOException<span style="color: rgba(102, 102, 102, 1)">,</span> ServletException <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">19</span>         String msg <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"登录超时或已在另一台机器登录，您被迫下线！"</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">20</span>         RespResult respResult <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> RespResult<span style="color: rgba(102, 102, 102, 1)">(0,</span> msg<span style="color: rgba(102, 102, 102, 1)">,</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">null</span><span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">21</span>         HttpServletResponse response <span style="color: rgba(102, 102, 102, 1)">=</span> event<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getResponse</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">22</span>         response<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">setContentType</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(186, 33, 33, 1)">"application/json;charset=utf-8"</span><span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">23</span>         PrintWriter writer <span style="color: rgba(102, 102, 102, 1)">=</span> response<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getWriter</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">24</span>         writer<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">write</span><span style="color: rgba(102, 102, 102, 1)">(</span>objectMapper<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">writeValueAsString</span><span style="color: rgba(102, 102, 102, 1)">(</span>respResult<span style="color: rgba(102, 102, 102, 1)">));</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">25</span>         writer<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">flush</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">26</span>         writer<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">close</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">27</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">28</span> <span style="color: rgba(102, 102, 102, 1)">}</span></span></pre>
</div>
<p><span style="font-size: 16px">退出成功</span></p>
<div class="highlight" style="background: rgba(248, 248, 248, 1)">
<pre><span style="font-size: 15px"><span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 1</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">package</span> <span style="color: rgba(125, 144, 41, 1)">com</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">example</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">demo5</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">handler</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 2</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 3</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.fasterxml.jackson.databind.ObjectMapper</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 4</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.beans.factory.annotation.Autowired</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 5</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.data.redis.core.StringRedisTemplate</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 6</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.core.Authentication</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 7</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.web.authentication.logout.LogoutSuccessHandler</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 8</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.stereotype.Component</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 9</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">10</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">javax.servlet.ServletException</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">11</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">javax.servlet.http.HttpServletRequest</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">12</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">javax.servlet.http.HttpServletResponse</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">13</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.io.IOException</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">14</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.io.PrintWriter</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">15</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">16</span> <span style="color: rgba(170, 34, 255, 1)">@Component</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">17</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">class</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">MyLogoutSuccessHandler</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">implements</span> LogoutSuccessHandler <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">18</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">19</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">static</span> ObjectMapper objectMapper <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> ObjectMapper<span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">20</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">21</span>     <span style="color: rgba(170, 34, 255, 1)">@Autowired</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">22</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> StringRedisTemplate stringRedisTemplate<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">23</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">24</span>     <span style="color: rgba(170, 34, 255, 1)">@Override</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">25</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(176, 0, 64, 1)">void</span> <span style="color: rgba(0, 0, 255, 1)">onLogoutSuccess</span><span style="color: rgba(102, 102, 102, 1)">(</span>HttpServletRequest request<span style="color: rgba(102, 102, 102, 1)">,</span> HttpServletResponse response<span style="color: rgba(102, 102, 102, 1)">,</span> Authentication authentication<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">throws</span> IOException<span style="color: rgba(102, 102, 102, 1)">,</span> ServletException <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">26</span>         String token <span style="color: rgba(102, 102, 102, 1)">=</span> request<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getHeader</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(186, 33, 33, 1)">"token"</span><span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">27</span>         stringRedisTemplate<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">delete</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(186, 33, 33, 1)">"TOKEN:"</span> <span style="color: rgba(102, 102, 102, 1)">+</span> token<span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">28</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">29</span>         response<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">setContentType</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(186, 33, 33, 1)">"application/json;charset=utf-8"</span><span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">30</span>         PrintWriter printWriter <span style="color: rgba(102, 102, 102, 1)">=</span> response<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getWriter</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">31</span>         printWriter<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">write</span><span style="color: rgba(102, 102, 102, 1)">(</span>objectMapper<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">writeValueAsString</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(186, 33, 33, 1)">"logout success"</span><span style="color: rgba(102, 102, 102, 1)">));</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">32</span>         printWriter<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">flush</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">33</span>         printWriter<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">close</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">34</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">35</span> <span style="color: rgba(102, 102, 102, 1)">}</span>
</span></pre>
</div>
<p style="color: inherit; line-height: inherit; padding: 0; margin: 1.6em 0; font-weight: bold; border-bottom: 2px solid rgba(104, 161, 90, 1); font-size: 1.6em"><span style="font-size: inherit; line-height: inherit; margin: 0 3px 0 0; display: inline-block; font-weight: normal; background: rgba(104, 161, 90, 1); color: rgba(255, 255, 255, 1); padding: 3px 10px 1px; border-top-right-radius: 3px; border-top-left-radius: 3px">5.&nbsp; Token处理</span></p>
<p><span style="font-size: 16px">现在由于前后端分离，服务端不再维持Session，于是需要token来作为访问凭证</span></p>
<p><span style="font-size: 16px">token工具类</span></p>
<div class="highlight" style="background: rgba(248, 248, 248, 1)">
<pre><span style="font-size: 15px"><span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 1</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">package</span> <span style="color: rgba(125, 144, 41, 1)">com</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">example</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">demo5</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">util</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 2</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 3</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">io.jsonwebtoken.*</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 4</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 5</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.util.Date</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 6</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.util.HashMap</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 7</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.util.Map</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 8</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.util.function.Function</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 9</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">10</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">/**</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">11</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @Author ChengJianSheng</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">12</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @Date 2021/5/7</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">13</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> */</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">14</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">class</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">JwtUtils</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">15</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">16</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">static</span> <span style="color: rgba(176, 0, 64, 1)">long</span> TOKEN_EXPIRATION <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(102, 102, 102, 1)">24</span> <span style="color: rgba(102, 102, 102, 1)">*</span> <span style="color: rgba(102, 102, 102, 1)">60</span> <span style="color: rgba(102, 102, 102, 1)">*</span> <span style="color: rgba(102, 102, 102, 1)">60</span> <span style="color: rgba(102, 102, 102, 1)">*</span> <span style="color: rgba(102, 102, 102, 1)">1000;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">17</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">static</span> String TOKEN_SECRET_KEY <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"123456"</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">18</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">19</span>     <span style="color: rgba(64, 128, 128, 1); font-style: italic">/**</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">20</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">     * 生成Token</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">21</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">     * @param subject   用户名</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">22</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">     * @return</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">23</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">     */</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">24</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">static</span> String <span style="color: rgba(0, 0, 255, 1)">createToken</span><span style="color: rgba(102, 102, 102, 1)">(</span>String subject<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">25</span>         <span style="color: rgba(176, 0, 64, 1)">long</span> currentTimeMillis <span style="color: rgba(102, 102, 102, 1)">=</span> System<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">currentTimeMillis</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">26</span>         Date currentDate <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> Date<span style="color: rgba(102, 102, 102, 1)">(</span>currentTimeMillis<span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">27</span>         Date expirationDate <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> Date<span style="color: rgba(102, 102, 102, 1)">(</span>currentTimeMillis <span style="color: rgba(102, 102, 102, 1)">+</span> TOKEN_EXPIRATION<span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">28</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">29</span>         <span style="color: rgba(64, 128, 128, 1); font-style: italic">//  存放自定义属性，比如用户拥有的权限</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">30</span>         Map<span style="color: rgba(102, 102, 102, 1)">&lt;</span>String<span style="color: rgba(102, 102, 102, 1)">,</span> Object<span style="color: rgba(102, 102, 102, 1)">&gt;</span> claims <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> HashMap<span style="color: rgba(102, 102, 102, 1)">&lt;&gt;();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">31</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">32</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">return</span> Jwts<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">builder</span><span style="color: rgba(102, 102, 102, 1)">()</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">33</span>                 <span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">setClaims</span><span style="color: rgba(102, 102, 102, 1)">(</span>claims<span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">34</span>                 <span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">setSubject</span><span style="color: rgba(102, 102, 102, 1)">(</span>subject<span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">35</span>                 <span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">setIssuedAt</span><span style="color: rgba(102, 102, 102, 1)">(</span>currentDate<span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">36</span>                 <span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">setExpiration</span><span style="color: rgba(102, 102, 102, 1)">(</span>expirationDate<span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">37</span>                 <span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">signWith</span><span style="color: rgba(102, 102, 102, 1)">(</span>SignatureAlgorithm<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">HS512</span><span style="color: rgba(102, 102, 102, 1)">,</span> TOKEN_SECRET_KEY<span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">38</span>                 <span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">compact</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">39</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">40</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">41</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">static</span> String <span style="color: rgba(0, 0, 255, 1)">extractUsername</span><span style="color: rgba(102, 102, 102, 1)">(</span>String token<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">42</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">return</span> <span style="color: rgba(0, 0, 255, 1)">extractClaim</span><span style="color: rgba(102, 102, 102, 1)">(</span>token<span style="color: rgba(102, 102, 102, 1)">,</span> <span style="color: rgba(160, 160, 0, 1)">Claims:</span><span style="color: rgba(102, 102, 102, 1)">:</span>getSubject<span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">43</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">44</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">45</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">static</span> <span style="color: rgba(176, 0, 64, 1)">boolean</span> <span style="color: rgba(0, 0, 255, 1)">isTokenExpired</span><span style="color: rgba(102, 102, 102, 1)">(</span>String token<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">46</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">return</span> <span style="color: rgba(0, 0, 255, 1)">extractExpiration</span><span style="color: rgba(102, 102, 102, 1)">(</span>token<span style="color: rgba(102, 102, 102, 1)">).</span><span style="color: rgba(125, 144, 41, 1)">before</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> Date<span style="color: rgba(102, 102, 102, 1)">());</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">47</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">48</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">49</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">static</span> Date <span style="color: rgba(0, 0, 255, 1)">extractExpiration</span><span style="color: rgba(102, 102, 102, 1)">(</span>String token<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">50</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">return</span> <span style="color: rgba(0, 0, 255, 1)">extractClaim</span><span style="color: rgba(102, 102, 102, 1)">(</span>token<span style="color: rgba(102, 102, 102, 1)">,</span> <span style="color: rgba(160, 160, 0, 1)">Claims:</span><span style="color: rgba(102, 102, 102, 1)">:</span>getExpiration<span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">51</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">52</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">53</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">static</span> <span style="color: rgba(102, 102, 102, 1)">&lt;</span>T<span style="color: rgba(102, 102, 102, 1)">&gt;</span> T extractClaim<span style="color: rgba(102, 102, 102, 1)">(</span>String token<span style="color: rgba(102, 102, 102, 1)">,</span> Function<span style="color: rgba(102, 102, 102, 1)">&lt;</span>Claims<span style="color: rgba(102, 102, 102, 1)">,</span> T<span style="color: rgba(102, 102, 102, 1)">&gt;</span> claimsResolver<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">54</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">final</span> Claims claims <span style="color: rgba(102, 102, 102, 1)">=</span> extractAllClaims<span style="color: rgba(102, 102, 102, 1)">(</span>token<span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">55</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">return</span> claimsResolver<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">apply</span><span style="color: rgba(102, 102, 102, 1)">(</span>claims<span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">56</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">57</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">58</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">static</span> Claims <span style="color: rgba(0, 0, 255, 1)">extractAllClaims</span><span style="color: rgba(102, 102, 102, 1)">(</span>String token<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">59</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">return</span> Jwts<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">parser</span><span style="color: rgba(102, 102, 102, 1)">().</span><span style="color: rgba(125, 144, 41, 1)">setSigningKey</span><span style="color: rgba(102, 102, 102, 1)">(</span>TOKEN_SECRET_KEY<span style="color: rgba(102, 102, 102, 1)">).</span><span style="color: rgba(125, 144, 41, 1)">parseClaimsJws</span><span style="color: rgba(102, 102, 102, 1)">(</span>token<span style="color: rgba(102, 102, 102, 1)">).</span><span style="color: rgba(125, 144, 41, 1)">getBody</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">60</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">61</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">62</span> <span style="color: rgba(102, 102, 102, 1)">}</span></span></pre>
</div>
<p><span style="font-size: 16px">前后端约定登录成功以后，将token放到header中。于是，我们需要过滤器来处理请求Header中的token，为此定义一个TokenFilter</span></p>
<div class="highlight" style="background: rgba(248, 248, 248, 1)">
<pre><span style="font-size: 15px"><span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 1</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">package</span> <span style="color: rgba(125, 144, 41, 1)">com</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">example</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">demo5</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">filter</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 2</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 3</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.alibaba.fastjson.JSON</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 4</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.example.demo5.domain.MyUserDetails</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 5</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.apache.commons.lang3.StringUtils</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 6</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.beans.factory.annotation.Autowired</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 7</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.data.redis.core.StringRedisTemplate</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 8</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.authentication.UsernamePasswordAuthenticationToken</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 9</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.core.context.SecurityContextHolder</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">10</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.stereotype.Component</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">11</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.web.filter.OncePerRequestFilter</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">12</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">13</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">javax.servlet.FilterChain</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">14</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">javax.servlet.ServletException</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">15</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">javax.servlet.http.HttpServletRequest</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">16</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">javax.servlet.http.HttpServletResponse</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">17</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.io.IOException</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">18</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.util.concurrent.TimeUnit</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">19</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">20</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">/**</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">21</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @Author ChengJianSheng</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">22</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @Date 2021/6/17</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">23</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> */</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">24</span> <span style="color: rgba(170, 34, 255, 1)">@Component</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">25</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">class</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">TokenFilter</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">extends</span> OncePerRequestFilter <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">26</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">27</span>     <span style="color: rgba(170, 34, 255, 1)">@Autowired</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">28</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> StringRedisTemplate stringRedisTemplate<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">29</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">30</span>     <span style="color: rgba(170, 34, 255, 1)">@Override</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">31</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">protected</span> <span style="color: rgba(176, 0, 64, 1)">void</span> <span style="color: rgba(0, 0, 255, 1)">doFilterInternal</span><span style="color: rgba(102, 102, 102, 1)">(</span>HttpServletRequest request<span style="color: rgba(102, 102, 102, 1)">,</span> HttpServletResponse response<span style="color: rgba(102, 102, 102, 1)">,</span> FilterChain chain<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">throws</span> ServletException<span style="color: rgba(102, 102, 102, 1)">,</span> IOException <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">32</span>         String token <span style="color: rgba(102, 102, 102, 1)">=</span> request<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getHeader</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(186, 33, 33, 1)">"token"</span><span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">33</span>         System<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">out</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">println</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(186, 33, 33, 1)">"请求头中带的token: "</span> <span style="color: rgba(102, 102, 102, 1)">+</span> token<span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">34</span>         String key <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"TOKEN:"</span> <span style="color: rgba(102, 102, 102, 1)">+</span> token<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">35</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">if</span> <span style="color: rgba(102, 102, 102, 1)">(</span>StringUtils<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">isNotBlank</span><span style="color: rgba(102, 102, 102, 1)">(</span>token<span style="color: rgba(102, 102, 102, 1)">))</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">36</span>             String value <span style="color: rgba(102, 102, 102, 1)">=</span> stringRedisTemplate<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">opsForValue</span><span style="color: rgba(102, 102, 102, 1)">().</span><span style="color: rgba(125, 144, 41, 1)">get</span><span style="color: rgba(102, 102, 102, 1)">(</span>key<span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">37</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">if</span> <span style="color: rgba(102, 102, 102, 1)">(</span>StringUtils<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">isNotBlank</span><span style="color: rgba(102, 102, 102, 1)">(</span>value<span style="color: rgba(102, 102, 102, 1)">))</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">38</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">//                String username = JwtUtils.extractUsername(token);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">39</span>                 MyUserDetails user <span style="color: rgba(102, 102, 102, 1)">=</span> JSON<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">parseObject</span><span style="color: rgba(102, 102, 102, 1)">(</span>value<span style="color: rgba(102, 102, 102, 1)">,</span> MyUserDetails<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">class</span><span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">40</span>                 <span style="color: rgba(0, 128, 0, 1); font-weight: bold">if</span> <span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(0, 128, 0, 1); font-weight: bold">null</span> <span style="color: rgba(102, 102, 102, 1)">!=</span> user <span style="color: rgba(102, 102, 102, 1)">&amp;&amp;</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">null</span> <span style="color: rgba(102, 102, 102, 1)">==</span> SecurityContextHolder<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getContext</span><span style="color: rgba(102, 102, 102, 1)">().</span><span style="color: rgba(125, 144, 41, 1)">getAuthentication</span><span style="color: rgba(102, 102, 102, 1)">())</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">41</span>                     UsernamePasswordAuthenticationToken authenticationToken <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> UsernamePasswordAuthenticationToken<span style="color: rgba(102, 102, 102, 1)">(</span>user<span style="color: rgba(102, 102, 102, 1)">,</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">null</span><span style="color: rgba(102, 102, 102, 1)">,</span> user<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getAuthorities</span><span style="color: rgba(102, 102, 102, 1)">());</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">42</span>                     SecurityContextHolder<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getContext</span><span style="color: rgba(102, 102, 102, 1)">().</span><span style="color: rgba(125, 144, 41, 1)">setAuthentication</span><span style="color: rgba(102, 102, 102, 1)">(</span>authenticationToken<span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">43</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">44</span>                     <span style="color: rgba(64, 128, 128, 1); font-style: italic">//  刷新token</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">45</span>                     <span style="color: rgba(64, 128, 128, 1); font-style: italic">//  如果生存时间小于10分钟，则再续1小时</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">46</span>                     <span style="color: rgba(176, 0, 64, 1)">long</span> time <span style="color: rgba(102, 102, 102, 1)">=</span> stringRedisTemplate<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getExpire</span><span style="color: rgba(102, 102, 102, 1)">(</span>key<span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">47</span>                     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">if</span> <span style="color: rgba(102, 102, 102, 1)">(</span>time <span style="color: rgba(102, 102, 102, 1)">&lt;</span> <span style="color: rgba(102, 102, 102, 1)">600)</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">48</span>                         stringRedisTemplate<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">expire</span><span style="color: rgba(102, 102, 102, 1)">(</span>key<span style="color: rgba(102, 102, 102, 1)">,</span> <span style="color: rgba(102, 102, 102, 1)">(</span>time <span style="color: rgba(102, 102, 102, 1)">+</span> <span style="color: rgba(102, 102, 102, 1)">3600),</span> TimeUnit<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">SECONDS</span><span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">49</span>                     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">50</span>                 <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">51</span>             <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">52</span>         <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">53</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">54</span>         chain<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">doFilter</span><span style="color: rgba(102, 102, 102, 1)">(</span>request<span style="color: rgba(102, 102, 102, 1)">,</span> response<span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">55</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">56</span> <span style="color: rgba(102, 102, 102, 1)">}</span></span></pre>
</div>
<p><span style="font-size: 16px">token过滤器做了两件事，一是获取header中的token，构造UsernamePasswordAuthenticationToken放入上下文中。权限可以从数据库中再查一遍，也可以直接从之前的缓存中获取。二是为token续期，即刷新token。&nbsp;</span></p>
<p><span style="font-size: 16px">由于我们采用jwt生成token，因此没法中途更改token的有效期，只能将其放到Redis中，通过更改Redis中key的生存时间来控制token的有效期。</span></p>
<p style="color: inherit; line-height: inherit; padding: 0; margin: 1.6em 0; font-weight: bold; border-bottom: 2px solid rgba(104, 161, 90, 1); font-size: 1.6em"><span style="font-size: inherit; line-height: inherit; margin: 0 3px 0 0; display: inline-block; font-weight: normal; background: rgba(104, 161, 90, 1); color: rgba(255, 255, 255, 1); padding: 3px 10px 1px; border-top-right-radius: 3px; border-top-left-radius: 3px">6.&nbsp; 访问控制</span></p>
<p><span style="font-size: 16px">首先来定义资源</span></p>
<div class="highlight" style="background: rgba(248, 248, 248, 1)">
<pre><span style="font-size: 15px"><span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 1</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">package</span> <span style="color: rgba(125, 144, 41, 1)">com</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">example</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">demo5</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">controller</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 2</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 3</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.access.prepost.PreAuthorize</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 4</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.web.bind.annotation.GetMapping</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 5</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.web.bind.annotation.RequestMapping</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 6</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.web.bind.annotation.RestController</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 7</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 8</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">/**</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 9</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @Author ChengJianSheng</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">10</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @Date 2021/6/12</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">11</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> */</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">12</span> <span style="color: rgba(170, 34, 255, 1)">@RestController</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">13</span> <span style="color: rgba(170, 34, 255, 1)">@RequestMapping</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(186, 33, 33, 1)">"/hello"</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">14</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">class</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">HelloController</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">15</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">16</span>     <span style="color: rgba(170, 34, 255, 1)">@PreAuthorize</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(186, 33, 33, 1)">"@myAccessDecisionService.hasPermission('hello:sayHello')"</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">17</span>     <span style="color: rgba(170, 34, 255, 1)">@GetMapping</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(186, 33, 33, 1)">"/sayHello"</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">18</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> String <span style="color: rgba(0, 0, 255, 1)">sayHello</span><span style="color: rgba(102, 102, 102, 1)">()</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">19</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">return</span> <span style="color: rgba(186, 33, 33, 1)">"hello"</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">20</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">21</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">22</span>     <span style="color: rgba(170, 34, 255, 1)">@PreAuthorize</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(186, 33, 33, 1)">"@myAccessDecisionService.hasPermission('hello:sayHi')"</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">23</span>     <span style="color: rgba(170, 34, 255, 1)">@GetMapping</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(186, 33, 33, 1)">"/sayHi"</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">24</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> String <span style="color: rgba(0, 0, 255, 1)">sayHi</span><span style="color: rgba(102, 102, 102, 1)">()</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">25</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">return</span> <span style="color: rgba(186, 33, 33, 1)">"hi"</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">26</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">27</span> <span style="color: rgba(102, 102, 102, 1)">}</span></span></pre>
</div>
<p><span style="font-size: 16px">资源的访问控制我们通过判断是否有相应的权限字符串</span></p>
<div class="highlight" style="background: rgba(248, 248, 248, 1)">
<pre><span style="font-size: 15px"><span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 1</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">package</span> <span style="color: rgba(125, 144, 41, 1)">com</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">example</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">demo5</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">service</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 2</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 3</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.core.Authentication</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 4</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.core.GrantedAuthority</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 5</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.core.authority.SimpleGrantedAuthority</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 6</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.core.context.SecurityContextHolder</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 7</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.core.userdetails.UserDetails</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 8</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.stereotype.Component</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 9</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">10</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.util.Set</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">11</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.util.stream.Collectors</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">12</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">13</span> <span style="color: rgba(170, 34, 255, 1)">@Component</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(186, 33, 33, 1)">"myAccessDecisionService"</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">14</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">class</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">MyAccessDecisionService</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">15</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">16</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(176, 0, 64, 1)">boolean</span> <span style="color: rgba(0, 0, 255, 1)">hasPermission</span><span style="color: rgba(102, 102, 102, 1)">(</span>String permission<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">17</span>         Authentication authentication <span style="color: rgba(102, 102, 102, 1)">=</span> SecurityContextHolder<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getContext</span><span style="color: rgba(102, 102, 102, 1)">().</span><span style="color: rgba(125, 144, 41, 1)">getAuthentication</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">18</span>         Object principal <span style="color: rgba(102, 102, 102, 1)">=</span> authentication<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getPrincipal</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">19</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">if</span> <span style="color: rgba(102, 102, 102, 1)">(</span>principal <span style="color: rgba(0, 128, 0, 1); font-weight: bold">instanceof</span> UserDetails<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">20</span>             UserDetails userDetails <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(102, 102, 102, 1)">(</span>UserDetails<span style="color: rgba(102, 102, 102, 1)">)</span> principal<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">21</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">//            SimpleGrantedAuthority simpleGrantedAuthority = new SimpleGrantedAuthority(permission);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">22</span>             Set<span style="color: rgba(102, 102, 102, 1)">&lt;</span>String<span style="color: rgba(102, 102, 102, 1)">&gt;</span> set <span style="color: rgba(102, 102, 102, 1)">=</span> userDetails<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getAuthorities</span><span style="color: rgba(102, 102, 102, 1)">().</span><span style="color: rgba(125, 144, 41, 1)">stream</span><span style="color: rgba(102, 102, 102, 1)">().</span><span style="color: rgba(125, 144, 41, 1)">map</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(160, 160, 0, 1)">GrantedAuthority:</span><span style="color: rgba(102, 102, 102, 1)">:</span>getAuthority<span style="color: rgba(102, 102, 102, 1)">).</span><span style="color: rgba(125, 144, 41, 1)">collect</span><span style="color: rgba(102, 102, 102, 1)">(</span>Collectors<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">toSet</span><span style="color: rgba(102, 102, 102, 1)">());</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">23</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">return</span> set<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">contains</span><span style="color: rgba(102, 102, 102, 1)">(</span>permission<span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">24</span>         <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">25</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">return</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">false</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">26</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">27</span> <span style="color: rgba(102, 102, 102, 1)">}</span>
</span></pre>
</div>
<p style="color: inherit; line-height: inherit; padding: 0; margin: 1.6em 0; font-weight: bold; border-bottom: 2px solid rgba(104, 161, 90, 1); font-size: 1.6em"><span style="font-size: inherit; line-height: inherit; margin: 0 3px 0 0; display: inline-block; font-weight: normal; background: rgba(104, 161, 90, 1); color: rgba(255, 255, 255, 1); padding: 3px 10px 1px; border-top-right-radius: 3px; border-top-left-radius: 3px">7.&nbsp; 配置WebSecurity</span></p>
<div class="highlight" style="background: rgba(248, 248, 248, 1)">
<pre><span style="font-size: 15px"><span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 1</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">package</span> <span style="color: rgba(125, 144, 41, 1)">com</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">example</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">demo5</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">config</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 2</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 3</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.example.demo5.filter.TokenFilter</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 4</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.example.demo5.handler.*</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 5</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.example.demo5.service.MyUserDetailsService</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 6</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.beans.factory.annotation.Autowired</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 7</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 8</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 9</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">10</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.config.annotation.web.configuration.EnableWebSecurity</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">11</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">12</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.config.http.SessionCreationPolicy</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">13</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">14</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.crypto.password.PasswordEncoder</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">15</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">16</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">17</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">/**</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">18</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @Author ChengJianSheng</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">19</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @Date 2021/6/12</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">20</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> */</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">21</span> <span style="color: rgba(170, 34, 255, 1)">@EnableGlobalMethodSecurity</span><span style="color: rgba(102, 102, 102, 1)">(</span>prePostEnabled <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">true</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">22</span> <span style="color: rgba(170, 34, 255, 1)">@EnableWebSecurity</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">23</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">class</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">WebSecurityConfig</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">extends</span> WebSecurityConfigurerAdapter <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">24</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">25</span>     <span style="color: rgba(170, 34, 255, 1)">@Autowired</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">26</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> MyUserDetailsService myUserDetailsService<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">27</span>     <span style="color: rgba(170, 34, 255, 1)">@Autowired</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">28</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> MyAuthenticationSuccessHandler myAuthenticationSuccessHandler<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">29</span>     <span style="color: rgba(170, 34, 255, 1)">@Autowired</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">30</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> MyAuthenticationFailureHandler myAuthenticationFailureHandler<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">31</span>     <span style="color: rgba(170, 34, 255, 1)">@Autowired</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">32</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> TokenFilter tokenFilter<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">33</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">34</span>     <span style="color: rgba(170, 34, 255, 1)">@Override</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">35</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">protected</span> <span style="color: rgba(176, 0, 64, 1)">void</span> <span style="color: rgba(0, 0, 255, 1)">configure</span><span style="color: rgba(102, 102, 102, 1)">(</span>AuthenticationManagerBuilder auth<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">throws</span> Exception <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">36</span>         auth<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">userDetailsService</span><span style="color: rgba(102, 102, 102, 1)">(</span>myUserDetailsService<span style="color: rgba(102, 102, 102, 1)">).</span><span style="color: rgba(125, 144, 41, 1)">passwordEncoder</span><span style="color: rgba(102, 102, 102, 1)">(</span>passwordEncoder<span style="color: rgba(102, 102, 102, 1)">());</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">37</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">38</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">39</span>     <span style="color: rgba(170, 34, 255, 1)">@Override</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">40</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">protected</span> <span style="color: rgba(176, 0, 64, 1)">void</span> <span style="color: rgba(0, 0, 255, 1)">configure</span><span style="color: rgba(102, 102, 102, 1)">(</span>HttpSecurity http<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">throws</span> Exception <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">41</span>         http<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">formLogin</span><span style="color: rgba(102, 102, 102, 1)">()</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">42</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">//                .usernameParameter("username")</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">43</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">//                .passwordParameter("password")</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">44</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">//                .loginPage("/login.html")</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">45</span>                 <span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">successHandler</span><span style="color: rgba(102, 102, 102, 1)">(</span>myAuthenticationSuccessHandler<span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">46</span>                 <span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">failureHandler</span><span style="color: rgba(102, 102, 102, 1)">(</span>myAuthenticationFailureHandler<span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">47</span>                 <span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">and</span><span style="color: rgba(102, 102, 102, 1)">()</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">48</span>                 <span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">logout</span><span style="color: rgba(102, 102, 102, 1)">().</span><span style="color: rgba(125, 144, 41, 1)">logoutSuccessHandler</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> MyLogoutSuccessHandler<span style="color: rgba(102, 102, 102, 1)">())</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">49</span>                 <span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">and</span><span style="color: rgba(102, 102, 102, 1)">()</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">50</span>                 <span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">authorizeRequests</span><span style="color: rgba(102, 102, 102, 1)">()</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">51</span>                 <span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">antMatchers</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(186, 33, 33, 1)">"/demo/login"</span><span style="color: rgba(102, 102, 102, 1)">).</span><span style="color: rgba(125, 144, 41, 1)">permitAll</span><span style="color: rgba(102, 102, 102, 1)">()</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">52</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">//                .antMatchers("/css/**", "/js/**", "/**/images/*.*").permitAll()</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">53</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">//                .regexMatchers(".+[.]jpg").permitAll()</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">54</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">//                .mvcMatchers("/hello").servletPath("/demo").permitAll()</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">55</span>                 <span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">anyRequest</span><span style="color: rgba(102, 102, 102, 1)">().</span><span style="color: rgba(125, 144, 41, 1)">authenticated</span><span style="color: rgba(102, 102, 102, 1)">()</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">56</span>                 <span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">and</span><span style="color: rgba(102, 102, 102, 1)">()</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">57</span>                 <span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">exceptionHandling</span><span style="color: rgba(102, 102, 102, 1)">()</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">58</span>                 <span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">accessDeniedHandler</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> MyAccessDeniedHandler<span style="color: rgba(102, 102, 102, 1)">())</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">59</span>                 <span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">authenticationEntryPoint</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> MyAuthenticationEntryPoint<span style="color: rgba(102, 102, 102, 1)">())</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">60</span>                 <span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">and</span><span style="color: rgba(102, 102, 102, 1)">()</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">61</span>                 <span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">sessionManagement</span><span style="color: rgba(102, 102, 102, 1)">().</span><span style="color: rgba(125, 144, 41, 1)">sessionCreationPolicy</span><span style="color: rgba(102, 102, 102, 1)">(</span>SessionCreationPolicy<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">STATELESS</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">62</span>                 <span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">maximumSessions</span><span style="color: rgba(102, 102, 102, 1)">(1)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">63</span>                 <span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">maxSessionsPreventsLogin</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(0, 128, 0, 1); font-weight: bold">false</span><span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">64</span>                 <span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">expiredSessionStrategy</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> MyExpiredSessionStrategy<span style="color: rgba(102, 102, 102, 1)">());</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">65</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">66</span>         http<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">addFilterBefore</span><span style="color: rgba(102, 102, 102, 1)">(</span>tokenFilter<span style="color: rgba(102, 102, 102, 1)">,</span> UsernamePasswordAuthenticationFilter<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">class</span><span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">67</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">68</span>         http<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">csrf</span><span style="color: rgba(102, 102, 102, 1)">().</span><span style="color: rgba(125, 144, 41, 1)">disable</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">69</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">70</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">71</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> PasswordEncoder <span style="color: rgba(0, 0, 255, 1)">passwordEncoder</span><span style="color: rgba(102, 102, 102, 1)">()</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">72</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">return</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> <span style="color: rgba(0, 0, 255, 1)">BCryptPasswordEncoder</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">73</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">74</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">75</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">static</span> <span style="color: rgba(176, 0, 64, 1)">void</span> <span style="color: rgba(0, 0, 255, 1)">main</span><span style="color: rgba(102, 102, 102, 1)">(</span>String<span style="color: rgba(102, 102, 102, 1)">[]</span> args<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">76</span>         System<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">out</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">println</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> BCryptPasswordEncoder<span style="color: rgba(102, 102, 102, 1)">().</span><span style="color: rgba(125, 144, 41, 1)">encode</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(186, 33, 33, 1)">"123456"</span><span style="color: rgba(102, 102, 102, 1)">));</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">77</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">78</span> <span style="color: rgba(102, 102, 102, 1)">}</span></span></pre>
</div>
<p><span style="font-size: 16px">注意，我们将自定义的TokenFilter放到UsernamePasswordAuthenticationFilter之前</span></p>
<p><span style="font-size: 16px">所有过滤器的顺序可以查看 org.springframework.security.config.annotation.web.builders.FilterComparator 或者&nbsp;org.springframework.security.config.annotation.web.builders.FilterOrderRegistration</span></p>
<p style="color: inherit; line-height: inherit; padding: 0; margin: 1.6em 0; font-weight: bold; border-bottom: 2px solid rgba(104, 161, 90, 1); font-size: 1.6em"><span style="font-size: inherit; line-height: inherit; margin: 0 3px 0 0; display: inline-block; font-weight: normal; background: rgba(104, 161, 90, 1); color: rgba(255, 255, 255, 1); padding: 3px 10px 1px; border-top-right-radius: 3px; border-top-left-radius: 3px">8.&nbsp; 看效果</span></p>
<p><img src="https://img2020.cnblogs.com/blog/874963/202106/874963-20210619200613380-1958114166.png" alt="" loading="lazy"></p>
<p><img src="https://img2020.cnblogs.com/blog/874963/202106/874963-20210619200320920-1659528971.png" alt="" loading="lazy"></p>
<p><img src="https://img2020.cnblogs.com/blog/874963/202106/874963-20210619200334815-586129126.png" alt="" loading="lazy"></p>
<p><img src="https://img2020.cnblogs.com/blog/874963/202106/874963-20210619200343574-1383513732.png" alt="" loading="lazy"></p>
<p><img src="https://img2020.cnblogs.com/blog/874963/202106/874963-20210619200721521-344958696.png" alt="" loading="lazy"></p>
<p><img src="https://img2020.cnblogs.com/blog/874963/202106/874963-20210619200752676-1703024331.png" alt="" loading="lazy"></p>
<p style="color: inherit; line-height: inherit; padding: 0; margin: 1.6em 0; font-weight: bold; border-bottom: 2px solid rgba(104, 161, 90, 1); font-size: 1.6em"><span style="font-size: inherit; line-height: inherit; margin: 0 3px 0 0; display: inline-block; font-weight: normal; background: rgba(104, 161, 90, 1); color: rgba(255, 255, 255, 1); padding: 3px 10px 1px; border-top-right-radius: 3px; border-top-left-radius: 3px">9.&nbsp; 补充：手机号+短信验证码登录</span></p>
<p><span style="font-size: 16px">参照org.springframework.security.authentication.UsernamePasswordAuthenticationToken写一个短信认证Token</span></p>
<div class="highlight" style="background: rgba(248, 248, 248, 1)">
<pre><span style="font-size: 15px"><span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 1</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">package</span> <span style="color: rgba(125, 144, 41, 1)">com</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">example</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">demo5</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">filter</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 2</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 3</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.authentication.AbstractAuthenticationToken</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 4</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.core.GrantedAuthority</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 5</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.core.SpringSecurityCoreVersion</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 6</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.util.Assert</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 7</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 8</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.util.Collection</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 9</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">10</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">/**</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">11</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @Author ChengJianSheng</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">12</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @Date 2021/5/12</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">13</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> */</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">14</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">class</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">SmsCodeAuthenticationToken</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">extends</span> AbstractAuthenticationToken <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">15</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">16</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">static</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">final</span> <span style="color: rgba(176, 0, 64, 1)">long</span> serialVersionUID <span style="color: rgba(102, 102, 102, 1)">=</span> SpringSecurityCoreVersion<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">SERIAL_VERSION_UID</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">17</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">18</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">final</span> Object principal<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">19</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">20</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> Object credentials<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">21</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">22</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 0, 255, 1)">SmsCodeAuthenticationToken</span><span style="color: rgba(102, 102, 102, 1)">(</span>Object principal<span style="color: rgba(102, 102, 102, 1)">,</span> Object credentials<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">23</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">super</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(0, 128, 0, 1); font-weight: bold">null</span><span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">24</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">this</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">principal</span> <span style="color: rgba(102, 102, 102, 1)">=</span> principal<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">25</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">this</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">credentials</span> <span style="color: rgba(102, 102, 102, 1)">=</span> credentials<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">26</span>         setAuthenticated<span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(0, 128, 0, 1); font-weight: bold">false</span><span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">27</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">28</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">29</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 0, 255, 1)">SmsCodeAuthenticationToken</span><span style="color: rgba(102, 102, 102, 1)">(</span>Object principal<span style="color: rgba(102, 102, 102, 1)">,</span> Object credentials<span style="color: rgba(102, 102, 102, 1)">,</span> Collection<span style="color: rgba(102, 102, 102, 1)">&lt;?</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">extends</span> GrantedAuthority<span style="color: rgba(102, 102, 102, 1)">&gt;</span> authorities<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">30</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">super</span><span style="color: rgba(102, 102, 102, 1)">(</span>authorities<span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">31</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">this</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">principal</span> <span style="color: rgba(102, 102, 102, 1)">=</span> principal<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">32</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">this</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">credentials</span> <span style="color: rgba(102, 102, 102, 1)">=</span> credentials<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">33</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">super</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">setAuthenticated</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(0, 128, 0, 1); font-weight: bold">true</span><span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">34</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">35</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">36</span>     <span style="color: rgba(170, 34, 255, 1)">@Override</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">37</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> Object <span style="color: rgba(0, 0, 255, 1)">getCredentials</span><span style="color: rgba(102, 102, 102, 1)">()</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">38</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">return</span> credentials<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">39</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">40</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">41</span>     <span style="color: rgba(170, 34, 255, 1)">@Override</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">42</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> Object <span style="color: rgba(0, 0, 255, 1)">getPrincipal</span><span style="color: rgba(102, 102, 102, 1)">()</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">43</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">return</span> principal<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">44</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">45</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">46</span>     <span style="color: rgba(170, 34, 255, 1)">@Override</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">47</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(176, 0, 64, 1)">void</span> <span style="color: rgba(0, 0, 255, 1)">setAuthenticated</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(176, 0, 64, 1)">boolean</span> authenticated<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">48</span>         Assert<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">isTrue</span><span style="color: rgba(102, 102, 102, 1)">(!</span>authenticated<span style="color: rgba(102, 102, 102, 1)">,</span> <span style="color: rgba(186, 33, 33, 1)">"Cannot set this token to trusted - use constructor which takes a GrantedAuthority list instead"</span><span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">49</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">super</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">setAuthenticated</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(0, 128, 0, 1); font-weight: bold">false</span><span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">50</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">51</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">52</span>     <span style="color: rgba(170, 34, 255, 1)">@Override</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">53</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(176, 0, 64, 1)">void</span> <span style="color: rgba(0, 0, 255, 1)">eraseCredentials</span><span style="color: rgba(102, 102, 102, 1)">()</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">54</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">super</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">eraseCredentials</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">55</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">56</span> <span style="color: rgba(102, 102, 102, 1)">}</span>
</span></pre>
</div>
<p><span style="font-size: 16px">参照org.springframework.security.authentication.dao.DaoAuthenticationProvider写一个自己的短信认证Provider</span></p>
<div class="highlight" style="background: rgba(248, 248, 248, 1)">
<pre><span style="font-size: 15px"><span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 1</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">package</span> <span style="color: rgba(125, 144, 41, 1)">com</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">example</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">demo5</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">filter</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 2</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 3</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.example.demo.service.MyUserDetailsService</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 4</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.apache.commons.lang3.StringUtils</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 5</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.authentication.AuthenticationProvider</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 6</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.authentication.BadCredentialsException</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 7</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.core.Authentication</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 8</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.core.AuthenticationException</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 9</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.core.userdetails.UserDetails</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">10</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">11</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">/**</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">12</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @Author ChengJianSheng</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">13</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @Date 2021/5/12</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">14</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> */</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">15</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">class</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">SmsAuthenticationProvider</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">implements</span> AuthenticationProvider <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">16</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">17</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> MyUserDetailsService myUserDetailsService<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">18</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">19</span>     <span style="color: rgba(170, 34, 255, 1)">@Override</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">20</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> Authentication <span style="color: rgba(0, 0, 255, 1)">authenticate</span><span style="color: rgba(102, 102, 102, 1)">(</span>Authentication authentication<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">throws</span> AuthenticationException <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">21</span>         <span style="color: rgba(64, 128, 128, 1); font-style: italic">//  校验验证码</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">22</span>         additionalAuthenticationChecks<span style="color: rgba(102, 102, 102, 1)">((</span>SmsCodeAuthenticationToken<span style="color: rgba(102, 102, 102, 1)">)</span> authentication<span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">23</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">24</span>         <span style="color: rgba(64, 128, 128, 1); font-style: italic">//  校验手机号</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">25</span>         String mobile <span style="color: rgba(102, 102, 102, 1)">=</span> authentication<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getPrincipal</span><span style="color: rgba(102, 102, 102, 1)">().</span><span style="color: rgba(125, 144, 41, 1)">toString</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">26</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">27</span>         UserDetails userDetails <span style="color: rgba(102, 102, 102, 1)">=</span> myUserDetailsService<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">loadUserByMobile</span><span style="color: rgba(102, 102, 102, 1)">(</span>mobile<span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">28</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">29</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">if</span> <span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(0, 128, 0, 1); font-weight: bold">null</span> <span style="color: rgba(102, 102, 102, 1)">==</span> userDetails<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">30</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">throw</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> <span style="color: rgba(0, 0, 255, 1)">BadCredentialsException</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(186, 33, 33, 1)">"手机号不存在"</span><span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">31</span>         <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">32</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">33</span>         <span style="color: rgba(64, 128, 128, 1); font-style: italic">//  创建认证成功的Authentication对象</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">34</span>         SmsCodeAuthenticationToken result <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> SmsCodeAuthenticationToken<span style="color: rgba(102, 102, 102, 1)">(</span>userDetails<span style="color: rgba(102, 102, 102, 1)">,</span> userDetails<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getAuthorities</span><span style="color: rgba(102, 102, 102, 1)">());</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">35</span>         result<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">setDetails</span><span style="color: rgba(102, 102, 102, 1)">(</span>authentication<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getDetails</span><span style="color: rgba(102, 102, 102, 1)">());</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">36</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">37</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">return</span> result<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">38</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">39</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">40</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">protected</span> <span style="color: rgba(176, 0, 64, 1)">void</span> <span style="color: rgba(0, 0, 255, 1)">additionalAuthenticationChecks</span><span style="color: rgba(102, 102, 102, 1)">(</span>SmsCodeAuthenticationToken authentication<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">throws</span> AuthenticationException <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">41</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">if</span> <span style="color: rgba(102, 102, 102, 1)">(</span>authentication<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getCredentials</span><span style="color: rgba(102, 102, 102, 1)">()</span> <span style="color: rgba(102, 102, 102, 1)">==</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">null</span><span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">42</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">throw</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> <span style="color: rgba(0, 0, 255, 1)">BadCredentialsException</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(186, 33, 33, 1)">"验证码不能为空"</span><span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">43</span>         <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">44</span>         String mobile <span style="color: rgba(102, 102, 102, 1)">=</span> authentication<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getPrincipal</span><span style="color: rgba(102, 102, 102, 1)">().</span><span style="color: rgba(125, 144, 41, 1)">toString</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">45</span>         String smsCode <span style="color: rgba(102, 102, 102, 1)">=</span> authentication<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getCredentials</span><span style="color: rgba(102, 102, 102, 1)">().</span><span style="color: rgba(125, 144, 41, 1)">toString</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">46</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">47</span>         <span style="color: rgba(64, 128, 128, 1); font-style: italic">//  从Session或者Redis中获取相应的验证码</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">48</span>         String smsCodeInSessionKey <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"SMS_CODE_"</span> <span style="color: rgba(102, 102, 102, 1)">+</span> mobile<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">49</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">//        String verificationCode = sessionStrategy.getAttribute(servletWebRequest, smsCodeInSessionKey);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">50</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">//        String verificationCode = stringRedisTemplate.opsForValue().get(smsCodeInSessionKey);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">51</span>         String verificationCode <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"1234"</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">52</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">53</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">if</span> <span style="color: rgba(102, 102, 102, 1)">(</span>StringUtils<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">isBlank</span><span style="color: rgba(102, 102, 102, 1)">(</span>verificationCode<span style="color: rgba(102, 102, 102, 1)">))</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">54</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">throw</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> <span style="color: rgba(0, 0, 255, 1)">BadCredentialsException</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(186, 33, 33, 1)">"短信验证码不存在，请重新发送！"</span><span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">55</span>         <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">56</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">if</span> <span style="color: rgba(102, 102, 102, 1)">(!</span>smsCode<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">equalsIgnoreCase</span><span style="color: rgba(102, 102, 102, 1)">(</span>verificationCode<span style="color: rgba(102, 102, 102, 1)">))</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">57</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">throw</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> <span style="color: rgba(0, 0, 255, 1)">BadCredentialsException</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(186, 33, 33, 1)">"验证码错误！"</span><span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">58</span>         <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">59</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">60</span>         <span style="color: rgba(64, 128, 128, 1); font-style: italic">//todo  清除Session或者Redis中获取相应的验证码</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">61</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">62</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">63</span>     <span style="color: rgba(170, 34, 255, 1)">@Override</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">64</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(176, 0, 64, 1)">boolean</span> <span style="color: rgba(0, 0, 255, 1)">supports</span><span style="color: rgba(102, 102, 102, 1)">(</span>Class<span style="color: rgba(102, 102, 102, 1)">&lt;?&gt;</span> authentication<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">65</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">return</span> <span style="color: rgba(102, 102, 102, 1)">(</span>SmsCodeAuthenticationToken<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">class</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">isAssignableFrom</span><span style="color: rgba(102, 102, 102, 1)">(</span>authentication<span style="color: rgba(102, 102, 102, 1)">));</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">66</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">67</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">68</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> MyUserDetailsService <span style="color: rgba(0, 0, 255, 1)">getMyUserDetailsService</span><span style="color: rgba(102, 102, 102, 1)">()</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">69</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">return</span> myUserDetailsService<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">70</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">71</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">72</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(176, 0, 64, 1)">void</span> <span style="color: rgba(0, 0, 255, 1)">setMyUserDetailsService</span><span style="color: rgba(102, 102, 102, 1)">(</span>MyUserDetailsService myUserDetailsService<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">73</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">this</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">myUserDetailsService</span> <span style="color: rgba(102, 102, 102, 1)">=</span> myUserDetailsService<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">74</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">75</span> <span style="color: rgba(102, 102, 102, 1)">}</span></span></pre>
</div>
<p><span style="font-size: 16px">参照org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter写一个短信认证处理的过滤器</span></p>
<div class="highlight" style="background: rgba(248, 248, 248, 1)">
<pre><span style="font-size: 15px"><span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 1</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">package</span> <span style="color: rgba(125, 144, 41, 1)">com</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">example</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">demo</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">filter</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 2</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 3</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.authentication.AuthenticationManager</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 4</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.authentication.AuthenticationServiceException</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 5</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.core.Authentication</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 6</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.core.AuthenticationException</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 7</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 8</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.web.util.matcher.AntPathRequestMatcher</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 9</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">10</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">javax.servlet.ServletException</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">11</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">javax.servlet.http.HttpServletRequest</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">12</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">javax.servlet.http.HttpServletResponse</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">13</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">java.io.IOException</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">14</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">15</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">/**</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">16</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @Author ChengJianSheng</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">17</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @Date 2021/5/12</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">18</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> */</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">19</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">class</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">SmsAuthenticationFilter</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">extends</span> AbstractAuthenticationProcessingFilter <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">20</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">21</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">static</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">final</span> String SPRING_SECURITY_FORM_MOBILE_KEY <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"mobile"</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">22</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">23</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">static</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">final</span> String SPRING_SECURITY_FORM_PASSWORD_KEY <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(186, 33, 33, 1)">"smsCode"</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">24</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">25</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">static</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">final</span> AntPathRequestMatcher DEFAULT_ANT_PATH_REQUEST_MATCHER <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> AntPathRequestMatcher<span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(186, 33, 33, 1)">"/login/mobile"</span><span style="color: rgba(102, 102, 102, 1)">,</span> <span style="color: rgba(186, 33, 33, 1)">"POST"</span><span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">26</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">27</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> String usernameParameter <span style="color: rgba(102, 102, 102, 1)">=</span> SPRING_SECURITY_FORM_MOBILE_KEY<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">28</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">29</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> String passwordParameter <span style="color: rgba(102, 102, 102, 1)">=</span> SPRING_SECURITY_FORM_PASSWORD_KEY<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">30</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">31</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> <span style="color: rgba(176, 0, 64, 1)">boolean</span> postOnly <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">true</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">32</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">33</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 0, 255, 1)">SmsAuthenticationFilter</span><span style="color: rgba(102, 102, 102, 1)">()</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">34</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">super</span><span style="color: rgba(102, 102, 102, 1)">(</span>DEFAULT_ANT_PATH_REQUEST_MATCHER<span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">35</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">36</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">37</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 0, 255, 1)">SmsAuthenticationFilter</span><span style="color: rgba(102, 102, 102, 1)">(</span>AuthenticationManager authenticationManager<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">38</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">super</span><span style="color: rgba(102, 102, 102, 1)">(</span>DEFAULT_ANT_PATH_REQUEST_MATCHER<span style="color: rgba(102, 102, 102, 1)">,</span> authenticationManager<span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">39</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">40</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">41</span>     <span style="color: rgba(170, 34, 255, 1)">@Override</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">42</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> Authentication <span style="color: rgba(0, 0, 255, 1)">attemptAuthentication</span><span style="color: rgba(102, 102, 102, 1)">(</span>HttpServletRequest request<span style="color: rgba(102, 102, 102, 1)">,</span> HttpServletResponse response<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">throws</span> AuthenticationException<span style="color: rgba(102, 102, 102, 1)">,</span> IOException<span style="color: rgba(102, 102, 102, 1)">,</span> ServletException <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">43</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">if</span> <span style="color: rgba(102, 102, 102, 1)">(</span>postOnly <span style="color: rgba(102, 102, 102, 1)">&amp;&amp;</span> <span style="color: rgba(102, 102, 102, 1)">!</span>request<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getMethod</span><span style="color: rgba(102, 102, 102, 1)">().</span><span style="color: rgba(125, 144, 41, 1)">equals</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(186, 33, 33, 1)">"POST"</span><span style="color: rgba(102, 102, 102, 1)">))</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">44</span>             <span style="color: rgba(0, 128, 0, 1); font-weight: bold">throw</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> <span style="color: rgba(0, 0, 255, 1)">AuthenticationServiceException</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(186, 33, 33, 1)">"Authentication method not supported: "</span> <span style="color: rgba(102, 102, 102, 1)">+</span> request<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getMethod</span><span style="color: rgba(102, 102, 102, 1)">());</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">45</span>         <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">46</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">47</span>         String mobile <span style="color: rgba(102, 102, 102, 1)">=</span> obtainMobile<span style="color: rgba(102, 102, 102, 1)">(</span>request<span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">48</span>         mobile <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(102, 102, 102, 1)">(</span>mobile <span style="color: rgba(102, 102, 102, 1)">!=</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">null</span><span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(102, 102, 102, 1)">?</span> mobile <span style="color: rgba(102, 102, 102, 1)">:</span> <span style="color: rgba(186, 33, 33, 1)">""</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">49</span>         mobile <span style="color: rgba(102, 102, 102, 1)">=</span> mobile<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">trim</span><span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">50</span>         String smsCode <span style="color: rgba(102, 102, 102, 1)">=</span> obtainPassword<span style="color: rgba(102, 102, 102, 1)">(</span>request<span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">51</span>         smsCode <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(102, 102, 102, 1)">(</span>smsCode <span style="color: rgba(102, 102, 102, 1)">!=</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">null</span><span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(102, 102, 102, 1)">?</span> smsCode <span style="color: rgba(102, 102, 102, 1)">:</span> <span style="color: rgba(186, 33, 33, 1)">""</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">52</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">53</span>         SmsCodeAuthenticationToken authRequest <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> SmsCodeAuthenticationToken<span style="color: rgba(102, 102, 102, 1)">(</span>mobile<span style="color: rgba(102, 102, 102, 1)">,</span> smsCode<span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">54</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">55</span>         setDetails<span style="color: rgba(102, 102, 102, 1)">(</span>request<span style="color: rgba(102, 102, 102, 1)">,</span> authRequest<span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">56</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">57</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">return</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">this</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getAuthenticationManager</span><span style="color: rgba(102, 102, 102, 1)">().</span><span style="color: rgba(125, 144, 41, 1)">authenticate</span><span style="color: rgba(102, 102, 102, 1)">(</span>authRequest<span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">58</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">59</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">60</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> String <span style="color: rgba(0, 0, 255, 1)">obtainMobile</span><span style="color: rgba(102, 102, 102, 1)">(</span>HttpServletRequest request<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">61</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">return</span> request<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getParameter</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(0, 128, 0, 1); font-weight: bold">this</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">usernameParameter</span><span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">62</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">63</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">64</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> String <span style="color: rgba(0, 0, 255, 1)">obtainPassword</span><span style="color: rgba(102, 102, 102, 1)">(</span>HttpServletRequest request<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">65</span>         <span style="color: rgba(0, 128, 0, 1); font-weight: bold">return</span> request<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getParameter</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(0, 128, 0, 1); font-weight: bold">this</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">passwordParameter</span><span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">66</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">67</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">68</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">protected</span> <span style="color: rgba(176, 0, 64, 1)">void</span> <span style="color: rgba(0, 0, 255, 1)">setDetails</span><span style="color: rgba(102, 102, 102, 1)">(</span>HttpServletRequest request<span style="color: rgba(102, 102, 102, 1)">,</span> SmsCodeAuthenticationToken authRequest<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">69</span>         authRequest<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">setDetails</span><span style="color: rgba(102, 102, 102, 1)">(</span><span style="color: rgba(0, 128, 0, 1); font-weight: bold">this</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">authenticationDetailsSource</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">buildDetails</span><span style="color: rgba(102, 102, 102, 1)">(</span>request<span style="color: rgba(102, 102, 102, 1)">));</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">70</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">71</span> <span style="color: rgba(102, 102, 102, 1)">}</span></span></pre>
</div>
<p><span style="font-size: 16px">在WebSecurity中进行配置</span></p>
<div class="highlight" style="background: rgba(248, 248, 248, 1)">
<pre><span style="font-size: 15px"><span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 1</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">package</span> <span style="color: rgba(125, 144, 41, 1)">com</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">example</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">demo</span><span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">config</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 2</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 3</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.example.demo.filter.SmsAuthenticationFilter</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 4</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.example.demo.filter.SmsAuthenticationProvider</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 5</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.example.demo.handler.MyAuthenticationFailureHandler</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 6</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.example.demo.handler.MyAuthenticationSuccessHandler</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 7</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">com.example.demo.service.MyUserDetailsService</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 8</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.beans.factory.annotation.Autowired</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px"> 9</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.authentication.AuthenticationManager</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">10</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.config.annotation.SecurityConfigurerAdapter</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">11</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">12</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.web.DefaultSecurityFilterChain</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">13</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">14</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">import</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">org.springframework.stereotype.Component</span><span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">15</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">16</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic">/**</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">17</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @Author ChengJianSheng</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">18</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> * @Date 2021/5/12</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">19</span> <span style="color: rgba(64, 128, 128, 1); font-style: italic"> */</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">20</span> <span style="color: rgba(170, 34, 255, 1)">@Component</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">21</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">class</span> <span style="color: rgba(0, 0, 255, 1); font-weight: bold">SmsAuthenticationConfig</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">extends</span> SecurityConfigurerAdapter<span style="color: rgba(102, 102, 102, 1)">&lt;</span>DefaultSecurityFilterChain<span style="color: rgba(102, 102, 102, 1)">,</span> HttpSecurity<span style="color: rgba(102, 102, 102, 1)">&gt;</span> <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">22</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">23</span>     <span style="color: rgba(170, 34, 255, 1)">@Autowired</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">24</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> MyUserDetailsService myUserDetailsService<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">25</span>     <span style="color: rgba(170, 34, 255, 1)">@Autowired</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">26</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> MyAuthenticationSuccessHandler myAuthenticationSuccessHandler<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">27</span>     <span style="color: rgba(170, 34, 255, 1)">@Autowired</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">28</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">private</span> MyAuthenticationFailureHandler myAuthenticationFailureHandler<span style="color: rgba(102, 102, 102, 1)">;</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">29</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">30</span>     <span style="color: rgba(170, 34, 255, 1)">@Override</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">31</span>     <span style="color: rgba(0, 128, 0, 1); font-weight: bold">public</span> <span style="color: rgba(176, 0, 64, 1)">void</span> <span style="color: rgba(0, 0, 255, 1)">configure</span><span style="color: rgba(102, 102, 102, 1)">(</span>HttpSecurity http<span style="color: rgba(102, 102, 102, 1)">)</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">throws</span> Exception <span style="color: rgba(102, 102, 102, 1)">{</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">32</span>         SmsAuthenticationFilter smsAuthenticationFilter <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> SmsAuthenticationFilter<span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">33</span>         smsAuthenticationFilter<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">setAuthenticationManager</span><span style="color: rgba(102, 102, 102, 1)">(</span>http<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">getSharedObject</span><span style="color: rgba(102, 102, 102, 1)">(</span>AuthenticationManager<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">class</span><span style="color: rgba(102, 102, 102, 1)">));</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">34</span>         smsAuthenticationFilter<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">setAuthenticationSuccessHandler</span><span style="color: rgba(102, 102, 102, 1)">(</span>myAuthenticationSuccessHandler<span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">35</span>         smsAuthenticationFilter<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">setAuthenticationFailureHandler</span><span style="color: rgba(102, 102, 102, 1)">(</span>myAuthenticationFailureHandler<span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">36</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">37</span>         SmsAuthenticationProvider smsAuthenticationProvider <span style="color: rgba(102, 102, 102, 1)">=</span> <span style="color: rgba(0, 128, 0, 1); font-weight: bold">new</span> SmsAuthenticationProvider<span style="color: rgba(102, 102, 102, 1)">();</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">38</span>         smsAuthenticationProvider<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">setMyUserDetailsService</span><span style="color: rgba(102, 102, 102, 1)">(</span>myUserDetailsService<span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">39</span> 
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">40</span>         http<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">authenticationProvider</span><span style="color: rgba(102, 102, 102, 1)">(</span>smsAuthenticationProvider<span style="color: rgba(102, 102, 102, 1)">)</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">41</span>                 <span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">addFilterAfter</span><span style="color: rgba(102, 102, 102, 1)">(</span>smsAuthenticationFilter<span style="color: rgba(102, 102, 102, 1)">,</span> UsernamePasswordAuthenticationFilter<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">class</span><span style="color: rgba(102, 102, 102, 1)">);</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">42</span>     <span style="color: rgba(102, 102, 102, 1)">}</span>
<span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">43</span> <span style="color: rgba(102, 102, 102, 1)">}</span>
</span></pre>
</div>
<div class="highlight" style="background: rgba(248, 248, 248, 1)">
<pre><span style="background-color: rgba(248, 248, 248, 1); padding: 0 5px">1</span> <span style="font-size: 15px">http<span style="color: rgba(102, 102, 102, 1)">.</span><span style="color: rgba(125, 144, 41, 1)">apply</span><span style="color: rgba(102, 102, 102, 1)">(</span>smsAuthenticationConfig<span style="color: rgba(102, 102, 102, 1)">);</span>
</span></pre>
</div>
<p>&nbsp;</p>
</div>
<div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
    <div id="blog_post_info"></div>
    <div class="clear"></div>
    <div id="post_next_prev"></div>
</div>
            </div>
            <div class="postDesc">posted @ 
<span id="post-date">2021-06-19 20:29</span>&nbsp;
<a href="https://www.cnblogs.com/cjsblog/">废物大师兄</a>&nbsp;
阅读(<span id="post_view_count">0</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=14904861" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(14904861);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '14904861', targetLink: 'https://www.cnblogs.com/cjsblog/p/14904861.html', title: '基于 Spring Security 的前后端分离的权限控制系统' })">举报</a></div>
        </div>
	    
	    
    </div><!--end: topics 文章、评论容器-->
</div>
<script src="https://common.cnblogs.com/highlight/10.3.1/highlight.min.js"></script>
<script>markdown_highlight();</script>
<script>
    var allowComments = true, cb_blogId = 303122, cb_blogApp = 'cjsblog', cb_blogUserGuid = 'bcbc924f-71b4-e511-9fc1-ac853d9f53cc';
    var cb_entryId = 14904861, cb_entryCreatedDate = '2021-06-19 20:29', cb_postType = 1;
    updatePostStats(
        [cb_entryId],
        function(id, count) { $("#post_view_count").text(count) },
        function(id, count) { $("#post_comment_count").text(count) })
    zoomManager.apply("#cnblogs_post_body img:not(.code_img_closed):not(.code_img_opened)");
</script>
<a name="!comments"></a>
<div id="blog-comments-placeholder"></div>
<div id="comment_form" class="commentform">
    <a name="commentform"></a>
    <div id="divCommentShow"></div>
    <div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" onclick="return RefreshCommentList();" id="lnk_RefreshComments" runat="server" clientidmode="Static">刷新评论</a><a href="#" onclick="return RefreshPage();">刷新页面</a><a href="#top">返回顶部</a></div>
    <div id="comment_form_container"></div>
    <div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
    <div id="ad_t2"></div>
    <div id="opt_under_post"></div>
    <div id="cnblogs_c1" class="under-post-card">
        <div id='div-gpt-ad-1592365906576-0' style='width: 300px; height: 250px;'></div>
    </div>
    <div id="under_post_card1"></div>
    <div id="cnblogs_c2" class="under-post-card">
        <div id='div-gpt-ad-1592366332455-0' style='width: 468px; height: 60px;'></div>
    </div>
    <div id="under_post_card2"></div>
    <div id="HistoryToday" class="under-post-card"></div>
    <script type="text/javascript">
       var commentManager = new blogCommentManager();
       commentManager.renderComments(0);
       fixPostBody();
       deliverBigBanner();
setTimeout(function() { incrementViewCount(cb_entryId); }, 50);       deliverT2();
       deliverC1C2();
       loadNewsAndKb();
       loadBlogSignature();
LoadPostCategoriesTags(cb_blogId, cb_entryId);       LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
       GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate, cb_postType);
       loadOptUnderPost();
       GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);
    </script>
</div>

	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->
	<div id="sideBar">
		<div id="sideBarMain">
			<div id="sidebar_news" class="newsItem">
            <script>loadBlogNews();</script>
</div>
<div id="sidebar_c3"></div>
			<div id="blog-calendar" style="display:none"></div><script>loadBlogDefaultCalendar();</script>			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn"></div>
                    <script>loadBlogSideColumn();</script>
			</div>			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer">
		<!--done-->
Copyright &copy; 2021 废物大师兄
<br /><span id="poweredby">Powered by .NET 5.0 on Kubernetes</span>



	</div><!--end: footer -->
</div><!--end: home 自定义的最大容器 -->


    <div id="page_end_html">
        <img src="https://files.cnblogs.com/files/cjsblog/reward.bmp" class="journal-reward" />
<script type="text/javascript" src="https://files.cnblogs.com/files/cjsblog/mycnblogs.js"></script>
<script type="text/javascript" src="https://files.cnblogs.com/files/cjsblog/love.js"></script>
<script type="text/javascript" src="https://files.cnblogs.com/files/cjsblog/flutter-hearts-zmt.js" charset="utf-8"></script>
<script type="text/javascript" src="https://blog-static.cnblogs.com/files/cjsblog/tctip-1.0.3.min.js"></script>
<script>
    new tctip({
        top: '20%',
        button: {
        id: 9,
        type: 'zanzhu'
    },
    list: [
    {
        type: 'alipay',
        qrImg: 'https://files-cdn.cnblogs.com/files/cjsblog/alipay.bmp'
    }, {
        type: 'wechat',
        qrImg: 'https://files-cdn.cnblogs.com/files/cjsblog/wechat.bmp'
    }
    ]
  }).init()
</script>
    </div>

    <input type="hidden" id="antiforgery_token" value="CfDJ8L-rpLgFVEJMgssCVvNUAjurTC_3iAsz6ewNCgCQPxpGNn728xCTAzOCND_a-2likQMlAPMLhLJTYZ0XrrpGW_zdS7NWzqG5TBPv1ER9ZTJ3VLI5pAS5kNoD7oULT59VFHROundbBuFI7tq35hlpJEs" />
</body>
</html>
